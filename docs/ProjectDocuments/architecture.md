# ğŸ“„ ARCHITECTURE.md

# LocalPilot - System Architecture

> Comprehensive architecture documentation for the LocalPilot VS Code extension

---

## Document Information

| Field | Value |
|-------|-------|
| **Project Name** | LocalPilot |
| **Author** | TarekRefaei |
| **Document Type** | Architecture Specification |
| **Related To** | PROJECT_OVERVIEW.md, PROJECT_STRUCTURE.md |
| **Last Updated** | [Current Date] |
| **Status** | Planning Phase |

---

## Table of Contents
1. [Architecture Overview](#1-architecture-overview)
2. [System Context](#2-system-context)
3. [High-Level Architecture](#3-high-level-architecture)
4. [Layer Architecture](#4-layer-architecture)
5. [Component Details](#5-component-details)
6. [Data Flow Diagrams](#6-data-flow-diagrams)
7. [Sequence Diagrams](#7-sequence-diagrams)
8. [Interface Definitions](#8-interface-definitions)
9. [State Management](#9-state-management)
10. [Error Handling Strategy](#10-error-handling-strategy)
11. [Security Considerations](#11-security-considerations)

---

## 1. Architecture Overview

### 1.1 Architecture Style

LocalPilot follows a **Practical Clean Architecture** pattern with clear separation of concerns:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ARCHITECTURE STYLE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  PATTERN: Practical Clean Architecture                          â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  KEY PRINCIPLES:                                                 â”‚
â”‚                                                                  â”‚
â”‚  1. DEPENDENCY RULE                                              â”‚
â”‚     Dependencies point INWARD only.                             â”‚
â”‚     Inner layers know nothing about outer layers.               â”‚
â”‚                                                                  â”‚
â”‚           UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                             â”‚
â”‚                                     â”‚                            â”‚
â”‚           Features â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â–º                        â”‚
â”‚                                     â”‚    â”‚                       â”‚
â”‚           Infrastructure â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â–º                   â”‚
â”‚                                     â”‚    â”‚    â”‚                  â”‚
â”‚                                     â–¼    â–¼    â–¼                  â”‚
â”‚                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                                 â”‚     CORE     â”‚                 â”‚
â”‚                                 â”‚  (Entities,  â”‚                 â”‚
â”‚                                 â”‚  Interfaces) â”‚                 â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                  â”‚
â”‚  2. INTERFACE SEGREGATION                                        â”‚
â”‚     Core defines interfaces (WHAT).                             â”‚
â”‚     Infrastructure implements (HOW).                            â”‚
â”‚                                                                  â”‚
â”‚  3. FEATURE-BASED ORGANIZATION                                   â”‚
â”‚     Related code lives together.                                â”‚
â”‚     Easy to find, easy to understand.                           â”‚
â”‚                                                                  â”‚
â”‚  4. TESTABILITY                                                  â”‚
â”‚     Core and Features can be tested without external deps.      â”‚
â”‚     Mock Infrastructure for unit tests.                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Architecture Decisions Summary

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **Monorepo vs Multi-repo** | Monorepo | Single source of truth, easier for solo dev |
| **Extension-Server Split** | Hybrid (TS + Python) | Best of both ecosystems |
| **Communication** | HTTP + WebSocket | REST for operations, WS for streaming |
| **State Management** | Zustand | Lightweight, simple, React-friendly |
| **RAG Framework** | LlamaIndex | Better for code indexing use case |
| **Vector Database** | ChromaDB | Simple setup, Python native |
| **LLM Provider** | Ollama | Local-first, privacy-focused |

---

## 2. System Context

### 2.1 System Context Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SYSTEM CONTEXT DIAGRAM                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                        â”‚             â”‚                          â”‚
â”‚                        â”‚  Developer  â”‚                          â”‚
â”‚                        â”‚   (User)    â”‚                          â”‚
â”‚                        â”‚             â”‚                          â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â”‚ Uses                             â”‚
â”‚                               â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚                     VS CODE IDE                             â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                 LOCALPILOT EXTENSION                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    Chat     â”‚  â”‚    Plan     â”‚  â”‚     Act     â”‚   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    Mode     â”‚  â”‚    Mode     â”‚  â”‚    Mode     â”‚   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                              â”‚                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚                                â”‚
â”‚                                 â”‚ HTTP/WebSocket                 â”‚
â”‚                                 â”‚ (localhost:8000)              â”‚
â”‚                                 â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚                    PYTHON RAG SERVER                        â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚  â”‚  â”‚  Indexing   â”‚  â”‚    RAG      â”‚  â”‚    Chat     â”‚        â”‚ â”‚
â”‚  â”‚  â”‚   Engine    â”‚  â”‚   Query     â”‚  â”‚   Handler   â”‚        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚              â”‚              â”‚                    â”‚
â”‚              â–¼              â–¼              â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚               â”‚  â”‚               â”‚  â”‚               â”‚       â”‚
â”‚  â”‚    OLLAMA     â”‚  â”‚   CHROMADB    â”‚  â”‚  FILE SYSTEM  â”‚       â”‚
â”‚  â”‚   (LLM API)   â”‚  â”‚ (Vector Store)â”‚  â”‚  (Workspace)  â”‚       â”‚
â”‚  â”‚               â”‚  â”‚               â”‚  â”‚               â”‚       â”‚
â”‚  â”‚ localhost:    â”‚  â”‚  Embedded     â”‚  â”‚  Project      â”‚       â”‚
â”‚  â”‚    11434      â”‚  â”‚  Database     â”‚  â”‚  Files        â”‚       â”‚
â”‚  â”‚               â”‚  â”‚               â”‚  â”‚               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 External Systems

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL DEPENDENCIES                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  SYSTEM: Ollama                                                  â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Purpose:    Local LLM inference engine                         â”‚
â”‚  Interface:  REST API on http://localhost:11434                 â”‚
â”‚  Required:   Yes (core dependency)                              â”‚
â”‚  Managed:    By user (must be installed separately)             â”‚
â”‚                                                                  â”‚
â”‚  Endpoints Used:                                                 â”‚
â”‚  â”œâ”€â”€ GET  /api/tags          - List available models           â”‚
â”‚  â”œâ”€â”€ POST /api/generate      - Text generation (streaming)     â”‚
â”‚  â”œâ”€â”€ POST /api/chat          - Chat completion (streaming)     â”‚
â”‚  â”œâ”€â”€ POST /api/embeddings    - Generate embeddings             â”‚
â”‚  â””â”€â”€ GET  /api/version       - Check Ollama version            â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  SYSTEM: VS Code                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Purpose:    Host IDE for the extension                         â”‚
â”‚  Interface:  VS Code Extension API                              â”‚
â”‚  Required:   Yes (runtime environment)                          â”‚
â”‚  Version:    1.85.0 or higher                                   â”‚
â”‚                                                                  â”‚
â”‚  APIs Used:                                                      â”‚
â”‚  â”œâ”€â”€ vscode.window         - UI interactions                    â”‚
â”‚  â”œâ”€â”€ vscode.workspace      - File system access                 â”‚
â”‚  â”œâ”€â”€ vscode.commands       - Command registration               â”‚
â”‚  â”œâ”€â”€ vscode.WebviewView    - Custom UI panels                   â”‚
â”‚  â””â”€â”€ vscode.OutputChannel  - Logging                            â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  SYSTEM: File System                                             â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Purpose:    Workspace files and index storage                  â”‚
â”‚  Interface:  VS Code FileSystem API + Node.js fs                â”‚
â”‚  Required:   Yes                                                 â”‚
â”‚                                                                  â”‚
â”‚  Locations:                                                      â”‚
â”‚  â”œâ”€â”€ Workspace folder      - User's project files               â”‚
â”‚  â”œâ”€â”€ ~/.localpilot/        - Index storage, settings            â”‚
â”‚  â””â”€â”€ Extension storage     - VS Code managed storage            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. High-Level Architecture

### 3.1 Container Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CONTAINER DIAGRAM                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    VS CODE PROCESS                        â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚           LOCALPILOT EXTENSION HOST                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                 (TypeScript)                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚               â”‚    â”‚                           â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   Extension   â”‚â—„â”€â”€â–ºâ”‚      WebView Panel        â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    Backend    â”‚    â”‚       (React App)         â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚               â”‚    â”‚                           â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Commands   â”‚    â”‚  â€¢ Chat UI                â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Services   â”‚    â”‚  â€¢ Plan UI                â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ VS Code    â”‚    â”‚  â€¢ Act UI                 â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    APIs       â”‚    â”‚  â€¢ State Management       â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚               â”‚    â”‚                           â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          â”‚                                           â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚             â”‚                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                â”‚                                                  â”‚
â”‚                â”‚ HTTP REST + WebSocket                            â”‚
â”‚                â”‚ (localhost:8000)                                â”‚
â”‚                â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚             â–¼                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚              PYTHON RAG SERVER                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                  (FastAPI)                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   API       â”‚ â”‚  Services   â”‚ â”‚ Infrastructure  â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   Routes    â”‚ â”‚             â”‚ â”‚                 â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚             â”‚ â”‚ â€¢ Indexing  â”‚ â”‚ â€¢ Ollama Client â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ /index    â”‚ â”‚ â€¢ RAG Query â”‚ â”‚ â€¢ ChromaDB      â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ /query    â”‚ â”‚ â€¢ Chat      â”‚ â”‚ â€¢ Tree-sitter   â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ /chat     â”‚ â”‚ â€¢ Sync      â”‚ â”‚ â€¢ LlamaIndex    â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ /health   â”‚ â”‚             â”‚ â”‚                 â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                      PYTHON PROCESS                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚                â”‚               â”‚               â”‚                    â”‚
â”‚                â–¼               â–¼               â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚     OLLAMA      â”‚ â”‚    CHROMADB     â”‚ â”‚   WORKSPACE     â”‚       â”‚
â”‚  â”‚    PROCESS      â”‚ â”‚   (Embedded)    â”‚ â”‚     FILES       â”‚       â”‚
â”‚  â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚       â”‚
â”‚  â”‚  LLM Models:    â”‚ â”‚  Collections:   â”‚ â”‚  User's code:   â”‚       â”‚
â”‚  â”‚  â€¢ qwen2.5-coderâ”‚ â”‚  â€¢ code_chunks  â”‚ â”‚  â€¢ .ts, .js     â”‚       â”‚
â”‚  â”‚  â€¢ mxbai-embed  â”‚ â”‚  â€¢ metadata     â”‚ â”‚  â€¢ .py, .dart   â”‚       â”‚
â”‚  â”‚                 â”‚ â”‚                 â”‚ â”‚  â€¢ etc.         â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Component Responsibilities

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 COMPONENT RESPONSIBILITIES                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  EXTENSION HOST (TypeScript)                                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Responsibilities:                                               â”‚
â”‚  â”œâ”€â”€ Extension lifecycle management                             â”‚
â”‚  â”œâ”€â”€ VS Code API integration                                     â”‚
â”‚  â”œâ”€â”€ WebView panel hosting and communication                    â”‚
â”‚  â”œâ”€â”€ Command registration and handling                          â”‚
â”‚  â”œâ”€â”€ File system operations (create/modify/delete)              â”‚
â”‚  â”œâ”€â”€ HTTP/WebSocket client for Python server                    â”‚
â”‚  â”œâ”€â”€ Settings management                                         â”‚
â”‚  â””â”€â”€ Status bar and notifications                               â”‚
â”‚                                                                  â”‚
â”‚  Does NOT:                                                       â”‚
â”‚  â”œâ”€â”€ Run LLM inference                                           â”‚
â”‚  â”œâ”€â”€ Manage vector database                                      â”‚
â”‚  â”œâ”€â”€ Parse code with Tree-sitter                                â”‚
â”‚  â””â”€â”€ Generate embeddings                                         â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  WEBVIEW PANEL (React)                                           â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Responsibilities:                                               â”‚
â”‚  â”œâ”€â”€ Render Chat/Plan/Act UI                                    â”‚
â”‚  â”œâ”€â”€ Manage UI state (Zustand)                                  â”‚
â”‚  â”œâ”€â”€ Handle user input                                           â”‚
â”‚  â”œâ”€â”€ Display streaming responses                                â”‚
â”‚  â”œâ”€â”€ Show diffs and code previews                               â”‚
â”‚  â”œâ”€â”€ Progress indicators                                         â”‚
â”‚  â””â”€â”€ Send messages to Extension Host                            â”‚
â”‚                                                                  â”‚
â”‚  Does NOT:                                                       â”‚
â”‚  â”œâ”€â”€ Access file system directly                                â”‚
â”‚  â”œâ”€â”€ Make HTTP calls to Python server                           â”‚
â”‚  â””â”€â”€ Access VS Code APIs directly                               â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PYTHON RAG SERVER (FastAPI)                                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Responsibilities:                                               â”‚
â”‚  â”œâ”€â”€ Workspace file scanning and parsing                        â”‚
â”‚  â”œâ”€â”€ AST-aware code chunking                                    â”‚
â”‚  â”œâ”€â”€ Embedding generation (via Ollama)                          â”‚
â”‚  â”œâ”€â”€ Vector storage and retrieval (ChromaDB)                    â”‚
â”‚  â”œâ”€â”€ RAG query processing                                        â”‚
â”‚  â”œâ”€â”€ LLM chat orchestration                                      â”‚
â”‚  â”œâ”€â”€ Streaming response handling                                â”‚
â”‚  â”œâ”€â”€ File hash tracking for sync                                â”‚
â”‚  â””â”€â”€ Index persistence                                           â”‚
â”‚                                                                  â”‚
â”‚  Does NOT:                                                       â”‚
â”‚  â”œâ”€â”€ Modify workspace files (extension does this)               â”‚
â”‚  â”œâ”€â”€ Access VS Code APIs                                         â”‚
â”‚  â””â”€â”€ Manage UI state                                             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Layer Architecture

### 4.1 Extension Layer Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                EXTENSION LAYER ARCHITECTURE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                     UI LAYER                                 â”‚â”‚
â”‚  â”‚              (Presentation & Interaction)                    â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚                 WebView (React)                       â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚ Components â”‚ â”‚   Hooks    â”‚ â”‚  Store (Zustand)â”‚    â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚â”‚
â”‚  â”‚  â”‚  Commands  â”‚  â”‚   Panels   â”‚  â”‚  Status Bar        â”‚     â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                              â”‚ Uses                              â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                   FEATURES LAYER                             â”‚â”‚
â”‚  â”‚               (Business Logic & Use Cases)                   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚  Indexing  â”‚ â”‚    Chat    â”‚ â”‚    Plan    â”‚ â”‚   Act    â”‚ â”‚â”‚
â”‚  â”‚  â”‚  Feature   â”‚ â”‚  Feature   â”‚ â”‚  Feature   â”‚ â”‚ Feature  â”‚ â”‚â”‚
â”‚  â”‚  â”‚            â”‚ â”‚            â”‚ â”‚            â”‚ â”‚          â”‚ â”‚â”‚
â”‚  â”‚  â”‚ â€¢Service   â”‚ â”‚ â€¢Service   â”‚ â”‚ â€¢Service   â”‚ â”‚ â€¢Service â”‚ â”‚â”‚
â”‚  â”‚  â”‚ â€¢SyncSvc   â”‚ â”‚ â€¢Context   â”‚ â”‚ â€¢Parser    â”‚ â”‚ â€¢Executorâ”‚ â”‚â”‚
â”‚  â”‚  â”‚ â€¢Progress  â”‚ â”‚  Builder   â”‚ â”‚ â€¢TaskExtr  â”‚ â”‚ â€¢CodeGen â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚   Ollama   â”‚ â”‚              Settings                   â”‚  â”‚â”‚
â”‚  â”‚  â”‚  Feature   â”‚ â”‚              Feature                    â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                              â”‚ Uses                              â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                     CORE LAYER                               â”‚â”‚
â”‚  â”‚            (Entities, Interfaces, Types)                     â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚    Entities    â”‚  â”‚   Interfaces   â”‚  â”‚    Errors    â”‚   â”‚â”‚
â”‚  â”‚  â”‚                â”‚  â”‚                â”‚  â”‚              â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Project      â”‚  â”‚ â€¢ ILLMProvider â”‚  â”‚ â€¢ BaseError  â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Message      â”‚  â”‚ â€¢ IRAGProvider â”‚  â”‚ â€¢ OllamaErr  â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Plan         â”‚  â”‚ â€¢ IFileSystem  â”‚  â”‚ â€¢ IndexErr   â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Task         â”‚  â”‚ â€¢ IIndexer     â”‚  â”‚              â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢ IndexedDoc   â”‚  â”‚ â€¢ ISettings    â”‚  â”‚              â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚                     Types                             â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â€¢ ModeType  â€¢ OllamaTypes  â€¢ EventTypes             â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                              â”‚ Implements                        â”‚
â”‚                              â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                INFRASTRUCTURE LAYER                          â”‚â”‚
â”‚  â”‚              (External Implementations)                      â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚â”‚
â”‚  â”‚  â”‚   VS Code  â”‚  â”‚    HTTP    â”‚  â”‚     WebSocket      â”‚     â”‚â”‚
â”‚  â”‚  â”‚  Adapters  â”‚  â”‚   Client   â”‚  â”‚      Client        â”‚     â”‚â”‚
â”‚  â”‚  â”‚            â”‚  â”‚            â”‚  â”‚                    â”‚     â”‚â”‚
â”‚  â”‚  â”‚ â€¢FileSys   â”‚  â”‚ â€¢ApiClient â”‚  â”‚ â€¢WSClient          â”‚     â”‚â”‚
â”‚  â”‚  â”‚ â€¢Settings  â”‚  â”‚ â€¢Endpoints â”‚  â”‚ â€¢StreamProcessor   â”‚     â”‚â”‚
â”‚  â”‚  â”‚ â€¢Output    â”‚  â”‚            â”‚  â”‚                    â”‚     â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Server Layer Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SERVER LAYER ARCHITECTURE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      API LAYER                               â”‚â”‚
â”‚  â”‚               (Routes, Schemas, WebSocket)                   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚                  FastAPI Routes                      â”‚    â”‚â”‚
â”‚  â”‚  â”‚                                                      â”‚    â”‚â”‚
â”‚  â”‚  â”‚  /health    /index    /query    /chat    /models    â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚â”‚
â”‚  â”‚  â”‚   Pydantic Schemas â”‚  â”‚    WebSocket Handlers      â”‚     â”‚â”‚
â”‚  â”‚  â”‚   (Request/Response)â”‚  â”‚    (Streaming)             â”‚     â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                              â”‚ Uses                              â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    SERVICES LAYER                            â”‚â”‚
â”‚  â”‚               (Business Logic Orchestration)                 â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚  Indexing  â”‚ â”‚    RAG     â”‚ â”‚    Chat    â”‚ â”‚   Sync   â”‚ â”‚â”‚
â”‚  â”‚  â”‚  Service   â”‚ â”‚  Service   â”‚ â”‚  Service   â”‚ â”‚ Service  â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚                  Summary Service                      â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                              â”‚ Uses                              â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                   INDEXING SUBSYSTEM                         â”‚â”‚
â”‚  â”‚            (Parsing, Chunking, Embedding)                    â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚â”‚
â”‚  â”‚  â”‚                   Parsers                           â”‚     â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚â”‚
â”‚  â”‚  â”‚  â”‚TypeScriptâ”‚ â”‚JavaScriptâ”‚ â”‚ Python â”‚ â”‚  Dart  â”‚  â”‚     â”‚â”‚
â”‚  â”‚  â”‚  â”‚  Parser  â”‚ â”‚  Parser  â”‚ â”‚ Parser â”‚ â”‚ Parser â”‚  â”‚     â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚â”‚
â”‚  â”‚  â”‚  Chunker   â”‚ â”‚  Scanner   â”‚ â”‚   Hash Tracker     â”‚       â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                              â”‚ Uses                              â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                     CORE LAYER                               â”‚â”‚
â”‚  â”‚            (Entities, Interfaces, Errors)                    â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚â”‚
â”‚  â”‚  â”‚  Entities  â”‚  â”‚  Interfaces  â”‚  â”‚     Errors     â”‚       â”‚â”‚
â”‚  â”‚  â”‚            â”‚  â”‚              â”‚  â”‚                â”‚       â”‚â”‚
â”‚  â”‚  â”‚ â€¢Document  â”‚  â”‚ â€¢IEmbedder   â”‚  â”‚ â€¢IndexingError â”‚       â”‚â”‚
â”‚  â”‚  â”‚ â€¢Chunk     â”‚  â”‚ â€¢IVectorStoreâ”‚  â”‚ â€¢OllamaError   â”‚       â”‚â”‚
â”‚  â”‚  â”‚ â€¢Embedding â”‚  â”‚ â€¢ILLM        â”‚  â”‚ â€¢ParseError    â”‚       â”‚â”‚
â”‚  â”‚  â”‚ â€¢QueryRes  â”‚  â”‚ â€¢IParser     â”‚  â”‚                â”‚       â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                              â”‚ Implements                        â”‚
â”‚                              â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                INFRASTRUCTURE LAYER                          â”‚â”‚
â”‚  â”‚              (External Implementations)                      â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚    Ollama    â”‚ â”‚   ChromaDB   â”‚ â”‚    Tree-sitter     â”‚   â”‚â”‚
â”‚  â”‚  â”‚              â”‚ â”‚              â”‚ â”‚                    â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢Client      â”‚ â”‚ â€¢Client      â”‚ â”‚ â€¢Parser wrapper    â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢Embedder    â”‚ â”‚ â€¢VectorStore â”‚ â”‚ â€¢Query files       â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢LLM         â”‚ â”‚              â”‚ â”‚                    â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚                    LlamaIndex                         â”‚   â”‚â”‚
â”‚  â”‚  â”‚         (Index Builder, Query Engine)                 â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Layer Communication Rules

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LAYER COMMUNICATION RULES                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ALLOWED DEPENDENCIES (â†’ means "can depend on")                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚                                                                  â”‚
â”‚  UI Layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º             â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€â”€â–º Features Layer (use services)                        â”‚
â”‚       â”œâ”€â”€â–º Core Layer (use entities, types)                     â”‚
â”‚       â””â”€â”€â–º Infrastructure Layer (ONLY through Features)         â”‚
â”‚                                                                  â”‚
â”‚                                                                  â”‚
â”‚  Features Layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º             â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€â”€â–º Core Layer (use entities, interfaces, types)        â”‚
â”‚       â””â”€â”€â–º Other Features (with caution, prefer events)        â”‚
â”‚                                                                  â”‚
â”‚                                                                  â”‚
â”‚  Infrastructure Layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º             â”‚
â”‚       â”‚                                                          â”‚
â”‚       â””â”€â”€â–º Core Layer (implement interfaces)                    â”‚
â”‚                                                                  â”‚
â”‚                                                                  â”‚
â”‚  Core Layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º             â”‚
â”‚       â”‚                                                          â”‚
â”‚       â””â”€â”€â–º NOTHING (innermost layer)                            â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  FORBIDDEN DEPENDENCIES (âœ—)                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  âœ— Core â†’ Features                                              â”‚
â”‚  âœ— Core â†’ Infrastructure                                        â”‚
â”‚  âœ— Core â†’ UI                                                    â”‚
â”‚  âœ— Features â†’ Infrastructure (use interfaces instead!)         â”‚
â”‚  âœ— Features â†’ UI                                                â”‚
â”‚  âœ— Infrastructure â†’ Features                                    â”‚
â”‚  âœ— Infrastructure â†’ UI                                          â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  EXAMPLE: How Chat Feature Uses Ollama                          â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚   ChatService   â”‚  (Features Layer)                          â”‚
â”‚  â”‚                 â”‚                                            â”‚
â”‚  â”‚  constructor(   â”‚                                            â”‚
â”‚  â”‚    llm: ILLMProvider  â—„â”€â”€â”€â”€ Interface from Core             â”‚
â”‚  â”‚  )              â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚           â”‚                                                      â”‚
â”‚           â”‚ At runtime, receives:                               â”‚
â”‚           â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚  OllamaService  â”‚  (Infrastructure Layer)                    â”‚
â”‚  â”‚                 â”‚                                            â”‚
â”‚  â”‚  implements     â”‚                                            â”‚
â”‚  â”‚  ILLMProvider   â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                                                  â”‚
â”‚  WHY? ChatService doesn't know about Ollama directly.          â”‚
â”‚  It only knows about ILLMProvider interface.                    â”‚
â”‚  This means we could swap Ollama for another LLM provider       â”‚
â”‚  without changing ChatService!                                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 Dependency Injection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DEPENDENCY INJECTION                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  EXTENSION (TypeScript)                                          â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  We use a simple "Composition Root" pattern:                    â”‚
â”‚                                                                  â”‚
â”‚  // extension.ts (entry point)                                   â”‚
â”‚                                                                  â”‚
â”‚  export async function activate(context: ExtensionContext) {    â”‚
â”‚                                                                  â”‚
â”‚    // 1. Create Infrastructure (implementations)                â”‚
â”‚    const fileSystem = new VSCodeFileSystemAdapter();            â”‚
â”‚    const httpClient = new ApiClient('http://localhost:8000');  â”‚
â”‚    const wsClient = new WebSocketClient();                      â”‚
â”‚                                                                  â”‚
â”‚    // 2. Create Features (inject dependencies)                  â”‚
â”‚    const ollamaFeature = new OllamaService(httpClient);         â”‚
â”‚    const indexingFeature = new IndexingService(httpClient);     â”‚
â”‚    const chatFeature = new ChatService(httpClient, wsClient);   â”‚
â”‚    const planFeature = new PlanService(chatFeature);            â”‚
â”‚    const actFeature = new ActService(fileSystem, chatFeature);  â”‚
â”‚                                                                  â”‚
â”‚    // 3. Create UI (inject features)                            â”‚
â”‚    const panel = new MainPanel(context, {                       â”‚
â”‚      ollama: ollamaFeature,                                      â”‚
â”‚      indexing: indexingFeature,                                  â”‚
â”‚      chat: chatFeature,                                          â”‚
â”‚      plan: planFeature,                                          â”‚
â”‚      act: actFeature,                                            â”‚
â”‚    });                                                           â”‚
â”‚                                                                  â”‚
â”‚    // 4. Register commands                                       â”‚
â”‚    registerCommands(context, { indexing, chat, plan, act });    â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  SERVER (Python)                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  We use FastAPI's dependency injection:                         â”‚
â”‚                                                                  â”‚
â”‚  # dependencies.py                                               â”‚
â”‚                                                                  â”‚
â”‚  from functools import lru_cache                                â”‚
â”‚                                                                  â”‚
â”‚  @lru_cache()                                                   â”‚
â”‚  def get_ollama_client() -> OllamaClient:                       â”‚
â”‚      return OllamaClient(base_url="http://localhost:11434")     â”‚
â”‚                                                                  â”‚
â”‚  @lru_cache()                                                   â”‚
â”‚  def get_vector_store() -> ChromaDBStore:                       â”‚
â”‚      return ChromaDBStore(persist_dir="~/.localpilot/indexes")  â”‚
â”‚                                                                  â”‚
â”‚  @lru_cache()                                                   â”‚
â”‚  def get_embedder(                                               â”‚
â”‚      client: OllamaClient = Depends(get_ollama_client)          â”‚
â”‚  ) -> OllamaEmbedder:                                            â”‚
â”‚      return OllamaEmbedder(client, model="mxbai-embed-large")   â”‚
â”‚                                                                  â”‚
â”‚  def get_indexing_service(                                       â”‚
â”‚      embedder: OllamaEmbedder = Depends(get_embedder),          â”‚
â”‚      store: ChromaDBStore = Depends(get_vector_store)           â”‚
â”‚  ) -> IndexingService:                                           â”‚
â”‚      return IndexingService(embedder, store)                    â”‚
â”‚                                                                  â”‚
â”‚  # routes/index.py                                               â”‚
â”‚                                                                  â”‚
â”‚  @router.post("/start")                                          â”‚
â”‚  async def start_indexing(                                       â”‚
â”‚      request: IndexRequest,                                      â”‚
â”‚      service: IndexingService = Depends(get_indexing_service)   â”‚
â”‚  ):                                                              â”‚
â”‚      return await service.index_workspace(request.path)         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Component Details

### 5.1 Extension Components Deep Dive

#### 5.1.1 Chat Feature

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CHAT FEATURE COMPONENT                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  PURPOSE:                                                        â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Enable natural language conversation about the codebase with   â”‚
â”‚  RAG-enhanced context retrieval.                                â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  INTERNAL STRUCTURE:                                             â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ChatService                           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Orchestrate chat conversation flow                   â”‚   â”‚
â”‚  â”‚  â€¢ Manage conversation history (session)                â”‚   â”‚
â”‚  â”‚  â€¢ Coordinate with Python server for RAG queries        â”‚   â”‚
â”‚  â”‚  â€¢ Handle streaming responses                           â”‚   â”‚
â”‚  â”‚  â€¢ Detect when plan should be created                   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Public Methods:                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ async sendMessage(message: string): Promise<void>  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Sends user message                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Triggers RAG query                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Receives streaming response                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Emits events for UI updates                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ async generateSummary(): Promise<string>           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Called after indexing completes                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Requests project summary from server           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Returns formatted summary                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ async transferToPlan(): Promise<Plan>              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Analyzes conversation context                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Requests plan generation from LLM              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Returns structured Plan entity                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ clearHistory(): void                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Clears current conversation                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Resets context window                          â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Dependencies:                                           â”‚   â”‚
â”‚  â”‚  â€¢ ApiClient (HTTP communication)                       â”‚   â”‚
â”‚  â”‚  â€¢ WebSocketClient (streaming)                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  ContextBuilder                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Build LLM prompt with RAG context                    â”‚   â”‚
â”‚  â”‚  â€¢ Manage context window budget                         â”‚   â”‚
â”‚  â”‚  â€¢ Format retrieved code chunks                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Key Method:                                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ buildPrompt(                                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   userMessage: string,                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   ragChunks: Chunk[],                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   history: Message[]                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ): string                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Algorithm:                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 1. Allocate token budget (8K model example):      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    - System prompt: 500 tokens                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    - RAG context: 2000 tokens                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    - History: 3500 tokens                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    - Current + buffer: 2000 tokens                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 2. Format RAG chunks:                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    For each chunk:                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Add file path, line numbers                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Add code with syntax highlighting markers    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Trim if exceeds budget                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 3. Trim history to fit budget:                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    Keep most recent messages                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    Remove oldest if needed                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 4. Assemble final prompt:                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    System + RAG Context + History + Current       â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   MessageHandler                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Process incoming streaming tokens                    â”‚   â”‚
â”‚  â”‚  â€¢ Detect special markers (code blocks, etc.)          â”‚   â”‚
â”‚  â”‚  â€¢ Emit UI update events                                â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Handles:                                                â”‚   â”‚
â”‚  â”‚  â€¢ Markdown code blocks                                  â”‚   â”‚
â”‚  â”‚  â€¢ File references                                       â”‚   â”‚
â”‚  â”‚  â€¢ Error messages                                        â”‚   â”‚
â”‚  â”‚  â€¢ Completion signals                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  DATA FLOW:                                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  User Input                                                      â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  ChatService.sendMessage()                                       â”‚
â”‚      â”‚                                                           â”‚
â”‚      â”œâ”€â”€â–º 1. Query RAG (HTTP POST /api/query)                   â”‚
â”‚      â”‚       â””â”€â”€â–º Returns: Chunk[]                              â”‚
â”‚      â”‚                                                           â”‚
â”‚      â”œâ”€â”€â–º 2. ContextBuilder.buildPrompt()                       â”‚
â”‚      â”‚       â””â”€â”€â–º Returns: formatted prompt                     â”‚
â”‚      â”‚                                                           â”‚
â”‚      â”œâ”€â”€â–º 3. Open WebSocket (/ws/chat)                          â”‚
â”‚      â”‚       â””â”€â”€â–º Send: { prompt, model, ... }                  â”‚
â”‚      â”‚                                                           â”‚
â”‚      â””â”€â”€â–º 4. MessageHandler processes stream                    â”‚
â”‚            â””â”€â”€â–º Emits: token events â†’ UI updates                â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  EVENTS EMITTED:                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  â€¢ 'message:start'    - New assistant message beginning         â”‚
â”‚  â€¢ 'message:token'    - New token received                      â”‚
â”‚  â€¢ 'message:complete' - Message fully received                  â”‚
â”‚  â€¢ 'message:error'    - Error occurred                          â”‚
â”‚  â€¢ 'rag:retrieved'    - RAG chunks retrieved                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.1.2 Plan Feature

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PLAN FEATURE COMPONENT                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  PURPOSE:                                                        â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Convert chat discussion into structured, actionable TODO list  â”‚
â”‚  with file paths and clear steps.                               â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  INTERNAL STRUCTURE:                                             â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    PlanService                           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Generate plan from conversation context              â”‚   â”‚
â”‚  â”‚  â€¢ Parse LLM output into Plan entity                    â”‚   â”‚
â”‚  â”‚  â€¢ Validate plan structure                               â”‚   â”‚
â”‚  â”‚  â€¢ Handle plan editing and regeneration                 â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Public Methods:                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ async generatePlan(                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   context: ConversationContext                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ): Promise<Plan>                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   Steps:                                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   1. Build planning prompt from context           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   2. Query RAG for relevant code structure        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   3. Send to LLM with planning system prompt      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   4. Parse LLM response                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   5. Validate plan structure                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   6. Return Plan entity                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ async regeneratePlan(                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   currentPlan: Plan,                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   feedback: string                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ): Promise<Plan>                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Incorporates user feedback                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Keeps what worked from current plan           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Modifies based on feedback                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ validatePlan(plan: Plan): ValidationResult        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   Checks:                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ All tasks have file paths                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ File paths exist or are valid new paths       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Tasks are atomic and clear                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Dependencies are logical                       â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    PlanParser                            â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Parse LLM markdown output into structured Plan      â”‚   â”‚
â”‚  â”‚  â€¢ Extract tasks with metadata                         â”‚   â”‚
â”‚  â”‚  â€¢ Handle various markdown formats gracefully          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Key Method:                                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ parse(markdown: string): Plan                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Expected Input Format:                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ## Plan: {Title}                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ### Overview                                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ {Description}                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ### Implementation Steps                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - [ ] 1. {Task Title}                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   ğŸ“ {file/path}                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€ {Detail}                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€ {Detail}                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - [ ] 2. {Task Title}                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   ...                                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Parsing Algorithm:                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 1. Extract title from ## Plan: line               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 2. Extract overview text                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 3. Find "### Implementation Steps" section        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 4. For each "- [ ]" checkbox:                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    a. Extract task number and title               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    b. Look for ğŸ“ or file path pattern            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    c. Extract indented details                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    d. Determine action type (create/modify/delete) â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    e. Create Task entity                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 5. Build dependency graph from task order         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 6. Return complete Plan entity                     â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   TaskExtractor                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Extract individual tasks from plan text             â”‚   â”‚
â”‚  â”‚  â€¢ Determine task type (create/modify/delete)          â”‚   â”‚
â”‚  â”‚  â€¢ Infer file paths if not explicitly stated           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Task Types:                                             â”‚   â”‚
â”‚  â”‚  â€¢ CREATE    - New file                                  â”‚   â”‚
â”‚  â”‚  â€¢ MODIFY    - Edit existing file                        â”‚   â”‚
â”‚  â”‚  â€¢ DELETE    - Remove file                               â”‚   â”‚
â”‚  â”‚  â€¢ COMMAND   - Run command (future, v1.1)               â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Inference Rules:                                        â”‚   â”‚
â”‚  â”‚  â€¢ "Create {file}" â†’ CREATE                             â”‚   â”‚
â”‚  â”‚  â€¢ "Update {file}" â†’ MODIFY                             â”‚   â”‚
â”‚  â”‚  â€¢ "Add to {file}" â†’ MODIFY                             â”‚   â”‚
â”‚  â”‚  â€¢ "Remove {file}" â†’ DELETE                             â”‚   â”‚
â”‚  â”‚  â€¢ "Install" â†’ COMMAND (skip in MVP)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  DATA STRUCTURES:                                                â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Plan Entity:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ interface Plan {                                       â”‚     â”‚
â”‚  â”‚   id: string;                                          â”‚     â”‚
â”‚  â”‚   title: string;                                       â”‚     â”‚
â”‚  â”‚   overview: string;                                    â”‚     â”‚
â”‚  â”‚   tasks: Task[];                                       â”‚     â”‚
â”‚  â”‚   createdAt: Date;                                     â”‚     â”‚
â”‚  â”‚   updatedAt: Date;                                     â”‚     â”‚
â”‚  â”‚   status: 'draft' | 'approved' | 'executing';         â”‚     â”‚
â”‚  â”‚ }                                                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  Task Entity:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ interface Task {                                       â”‚     â”‚
â”‚  â”‚   id: string;                                          â”‚     â”‚
â”‚  â”‚   orderIndex: number;                                  â”‚     â”‚
â”‚  â”‚   title: string;                                       â”‚     â”‚
â”‚  â”‚   description: string;                                 â”‚     â”‚
â”‚  â”‚   filePath: string;                                    â”‚     â”‚
â”‚  â”‚   actionType: 'create' | 'modify' | 'delete';         â”‚     â”‚
â”‚  â”‚   details: string[];                                   â”‚     â”‚
â”‚  â”‚   dependencies: string[]; // task IDs                  â”‚     â”‚
â”‚  â”‚   status: 'pending' | 'running' | 'done' | 'error';   â”‚     â”‚
â”‚  â”‚   estimatedComplexity?: 'simple' | 'medium' | 'complex';â”‚    â”‚
â”‚  â”‚ }                                                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.1.3 Act Feature

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ACT FEATURE COMPONENT                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  PURPOSE:                                                        â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Execute plan tasks step-by-step, generating code and modifying â”‚
â”‚  files with user approval at each step.                         â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  INTERNAL STRUCTURE:                                             â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     ActService                           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Orchestrate task execution                           â”‚   â”‚
â”‚  â”‚  â€¢ Manage execution state and progress                  â”‚   â”‚
â”‚  â”‚  â€¢ Handle pause/resume/stop                             â”‚   â”‚
â”‚  â”‚  â€¢ Create TODO markdown file                            â”‚   â”‚
â”‚  â”‚  â€¢ Emit progress events                                 â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Public Methods:                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ async executePlan(plan: Plan): Promise<void>       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   Flow:                                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   1. Create TODO.md file in workspace              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   2. Initialize execution state                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   3. For each task in plan.tasks:                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      a. Set task status = 'running'                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      b. Execute task (via TaskExecutor)            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      c. If user approval needed, wait              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      d. Apply changes if approved                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      e. Set task status = 'done' | 'error'         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      f. Update TODO.md                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   4. Emit completion event                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ pause(): void                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Pauses after current task completes            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ resume(): void                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Continues from next pending task               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ stop(): void                                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Cancels execution immediately                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Marks remaining tasks as 'pending'             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  State Machine:                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    IDLE â”€â”€â–º RUNNING â”€â”€â–º PAUSED â”€â”€â–º RUNNING        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â–²         â”‚                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚         â”‚                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚              â–¼  â”‚         â–¼                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚           STOPPED â—„â”€â”€ COMPLETED                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   TaskExecutor                           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Execute a single task                                â”‚   â”‚
â”‚  â”‚  â€¢ Generate code for the task                          â”‚   â”‚
â”‚  â”‚  â€¢ Create file diff if modifying                       â”‚   â”‚
â”‚  â”‚  â€¢ Return execution result                             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Key Method:                                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ async executeTask(                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   task: Task,                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   context: ExecutionContext                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ): Promise<TaskResult>                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Algorithm by Action Type:                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ CREATE:                                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   1. Generate code via CodeGenerator               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   2. Preview code to user                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   3. Wait for approval                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   4. Write file via FileWriter                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   5. Return success/failure                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ MODIFY:                                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   1. Read existing file                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   2. Generate new version via CodeGenerator        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   3. Create diff via DiffGenerator                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   4. Show diff to user                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   5. Wait for approval                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   6. Apply changes via FileWriter                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   7. Return success/failure                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ DELETE:                                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   1. Confirm file exists                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   2. Show file contents to user                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   3. Wait for deletion approval                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   4. Delete file via FileWriter                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   5. Return success/failure                        â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   CodeGenerator                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Generate code for a specific task                    â”‚   â”‚
â”‚  â”‚  â€¢ Use RAG to understand project patterns              â”‚   â”‚
â”‚  â”‚  â€¢ Ensure code follows project conventions             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Key Method:                                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ async generateCode(                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   task: Task,                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   context: CodeContext                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ): Promise<string>                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Process:                                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 1. Query RAG for similar code patterns            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â””â”€ "Find examples of {task.type} in {lang}"    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 2. If MODIFY, get existing file content           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 3. Build generation prompt:                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Task description                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Similar code examples from RAG               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Existing file content (if MODIFY)            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Project conventions                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Language-specific guidelines                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 4. Send to LLM (via Python server)                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 5. Extract code from LLM response                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â””â”€ Remove markdown markers                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â””â”€ Validate syntax (basic)                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 6. Return generated code                           â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   DiffGenerator                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Generate unified diff between old and new code      â”‚   â”‚
â”‚  â”‚  â€¢ Format diff for display                             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Uses library: 'diff' (npm package)                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Output Format:                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ --- a/src/auth/auth.service.ts                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ +++ b/src/auth/auth.service.ts                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ @@ -1,5 +1,8 @@                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  import { Injectable } from '@nestjs/common';      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ +import { JwtService } from '@nestjs/jwt';         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  export class AuthService {                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ -  // TODO: implement                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ +  constructor(private jwt: JwtService) {}         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ +                                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ +  async login(user: User) {                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ +    return this.jwt.sign({ sub: user.id });       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ +  }                                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  }                                                  â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    FileWriter                            â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Responsibilities:                                       â”‚   â”‚
â”‚  â”‚  â€¢ Write files to workspace safely                     â”‚   â”‚
â”‚  â”‚  â€¢ Create backup before modifying                      â”‚   â”‚
â”‚  â”‚  â€¢ Handle file system errors                           â”‚   â”‚
â”‚  â”‚  â€¢ Trigger re-indexing for modified files              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Key Methods:                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ async createFile(                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   path: string,                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   content: string                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ): Promise<void>                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ async modifyFile(                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   path: string,                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   newContent: string                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ): Promise<void>                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Safety Features:                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Creates .localpilot/backups/{timestamp}/         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Backs up before modify                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Validates paths (no outside workspace)           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Handles permissions errors                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Triggers index update after write                â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  EVENTS EMITTED:                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  â€¢ 'execution:started'     - Plan execution began               â”‚
â”‚  â€¢ 'task:started'          - Task execution started             â”‚
â”‚  â€¢ 'task:code-generated'   - Code generated, awaiting approval  â”‚
â”‚  â€¢ 'task:completed'        - Task successfully completed        â”‚
â”‚  â€¢ 'task:error'            - Task failed                        â”‚
â”‚  â€¢ 'task:skipped'          - User skipped task                  â”‚
â”‚  â€¢ 'execution:paused'      - Execution paused                   â”‚
â”‚  â€¢ 'execution:completed'   - All tasks completed                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Server Components Deep Dive

#### 5.2.1 Indexing Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   INDEXING SERVICE COMPONENT                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  PURPOSE:                                                        â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Orchestrate the entire indexing pipeline from file scanning    â”‚
â”‚  to vector storage.                                             â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  CLASS DIAGRAM:                                                  â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  IndexingService                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Dependencies:                                           â”‚   â”‚
â”‚  â”‚  â€¢ scanner: FileScanner                                  â”‚   â”‚
â”‚  â”‚  â€¢ parser_factory: ParserFactory                        â”‚   â”‚
â”‚  â”‚  â€¢ chunker: Chunker                                      â”‚   â”‚
â”‚  â”‚  â€¢ embedder: IEmbedder                                   â”‚   â”‚
â”‚  â”‚  â€¢ vector_store: IVectorStore                           â”‚   â”‚
â”‚  â”‚  â€¢ hash_tracker: HashTracker                            â”‚   â”‚
â”‚  â”‚  â€¢ progress_tracker: ProgressTracker                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Public Methods:                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ async def index_workspace(                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     self,                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     workspace_path: str,                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     project_id: str                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ) -> IndexResult                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Pipeline:                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 1. SCAN PHASE                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    files = scanner.scan(workspace_path)            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Recursively find all files                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Filter by extensions                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Respect .gitignore                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Skip node_modules, .git, etc.                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 2. PARSE & CHUNK PHASE                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    For each file:                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      a. Detect language from extension            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      b. Get appropriate parser                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      c. Parse file â†’ AST                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      d. Extract code units (functions, classes)   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      e. Create chunks with metadata                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      f. Report progress                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 3. EMBEDDING PHASE                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    For each chunk:                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      a. Generate embedding via Ollama              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      b. Attach metadata (file, line, type)         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      c. Report progress                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 4. STORAGE PHASE                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    Batch insert embeddings to ChromaDB             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Collection: project_{project_id}              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    â€¢ Persist to disk                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 5. HASH TRACKING                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    For each file:                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Save hash to tracker for sync                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 6. RETURN RESULT                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    return IndexResult(                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      files_indexed=count,                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      chunks_created=count,                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      embeddings_generated=count,                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      duration=elapsed_time                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    )                                               â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ async def sync_index(                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     self,                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     workspace_path: str,                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     project_id: str                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ) -> SyncResult                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Smart Sync Algorithm:                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 1. Scan workspace files                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 2. For each file:                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    current_hash = hash_file(file)                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    stored_hash = hash_tracker.get(file)            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    if current_hash != stored_hash:                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      changed_files.add(file)                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 3. Find deleted files                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    for file in hash_tracker:                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      if not exists(file):                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        deleted_files.add(file)                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 4. Re-index changed files only                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    For each changed_file:                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      a. Remove old embeddings from vector store    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      b. Re-parse, chunk, embed                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      c. Insert new embeddings                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      d. Update hash tracker                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 5. Clean up deleted files                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    For each deleted_file:                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      a. Remove embeddings from vector store        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      b. Remove from hash tracker                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 6. Return sync statistics                          â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.2.2 RAG Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RAG SERVICE COMPONENT                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  PURPOSE:                                                        â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Handle retrieval-augmented generation queries to find relevant â”‚
â”‚  code context for LLM prompts.                                  â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  CLASS DIAGRAM:                                                  â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     RAGService                           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Dependencies:                                           â”‚   â”‚
â”‚  â”‚  â€¢ embedder: IEmbedder                                   â”‚   â”‚
â”‚  â”‚  â€¢ vector_store: IVectorStore                           â”‚   â”‚
â”‚  â”‚  â€¢ llama_index: LlamaIndexAdapter                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Key Method:                                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ async def query(                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     self,                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     query_text: str,                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     project_id: str,                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     top_k: int = 5,                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     filters: Optional[Dict] = None                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ) -> List[Chunk]                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Algorithm:                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 1. EMBED QUERY                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    query_embedding = await embedder.embed(         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        query_text                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    )                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    # Returns: List[float] of 1024 dimensions       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 2. SIMILARITY SEARCH                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    results = vector_store.search(                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        collection=f"project_{project_id}",         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        query_embedding=query_embedding,            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        top_k=top_k,                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        filters=filters  # e.g., {"file_type": "ts"}â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    )                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    # ChromaDB returns closest vectors by cosine    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 3. RERANK (optional, simple scoring)               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    For each result:                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      # Boost recent files                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      if result.modified_recently:                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        result.score *= 1.1                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      # Boost exact file name matches               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      if query_text in result.file_path:            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        result.score *= 1.2                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    Sort by adjusted score                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 4. HYDRATE CHUNKS                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    For each result:                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Create Chunk object with:                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      â€¢ content (code text)                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      â€¢ file_path                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      â€¢ line_start, line_end                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      â€¢ chunk_type (function, class, etc.)          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      â€¢ language                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      â€¢ similarity_score                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 5. RETURN                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    return chunks[:top_k]                           â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Specialized Query Methods:                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ query_by_file(file_path: str) -> List[Chunk]      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Returns all chunks from specific file          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ query_by_symbol(symbol_name: str) -> List[Chunk]  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Finds function/class by name                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ get_project_summary(project_id: str) -> Summary   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Analyzes all chunks                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Returns project statistics                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Lists main files, languages, structure         â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 5.2.3 Chunk ID Generation

Chunk IDs are deterministic hashes to enable:
- Sync detection (compare IDs across sessions)
- Deduplication
- Reproducible indexing

**Algorithm:**
```python
def generate_chunk_id(file_path: str, content: str, chunk_type: str, line_start: int) -> str:
    data = f"{file_path}|{content}|{chunk_type}|{line_start}"
    return hashlib.sha256(data.encode()).hexdigest()[:16]
```

---

## 6. Data Flow Diagrams

### 6.1 Complete Indexing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INDEXING DATA FLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  USER CLICKS "INDEX PROJECT"                                     â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Extension: IndexingFeature.startIndexing()              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â”‚ HTTP POST /api/index/start          â”‚
â”‚                           â”‚ Body: { workspace_path, project_id }â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Server: IndexingService.index_workspace()               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚         â”‚                 â”‚                 â”‚                  â”‚
â”‚         â–¼                 â–¼                 â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   SCAN     â”‚   â”‚   PARSE    â”‚   â”‚   EMBED    â”‚             â”‚
â”‚  â”‚   FILES    â”‚â”€â”€â–ºâ”‚   & CHUNK  â”‚â”€â”€â–ºâ”‚  & STORE   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  DETAILED BREAKDOWN:                                             â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  STEP 1: SCAN FILES                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FileScanner.scan("/path/to/workspace")                 â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Input:  workspace_path                                 â”‚   â”‚
â”‚  â”‚  Output: List[FileInfo]                                 â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  FileInfo:                                               â”‚   â”‚
â”‚  â”‚    {                                                     â”‚   â”‚
â”‚  â”‚      path: "/workspace/src/auth/login.ts",              â”‚   â”‚
â”‚  â”‚      extension: ".ts",                                  â”‚   â”‚
â”‚  â”‚      size: 2048,                                        â”‚   â”‚
â”‚  â”‚      language: "typescript"                             â”‚   â”‚
â”‚  â”‚    }                                                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Filters:                                                â”‚   â”‚
â”‚  â”‚  â€¢ Include: .ts, .js, .py, .dart                        â”‚   â”‚
â”‚  â”‚  â€¢ Exclude: node_modules/, .git/, dist/, build/         â”‚   â”‚
â”‚  â”‚  â€¢ Respects: .gitignore                                 â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Progress Event (WebSocket):                            â”‚   â”‚
â”‚  â”‚    { type: "scan", progress: 0.2, current: "src/..." }  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  STEP 2: PARSE & CHUNK                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  For each FileInfo:                                      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  1. Get Parser                                           â”‚   â”‚
â”‚  â”‚     parser = ParserFactory.get(file.language)            â”‚   â”‚
â”‚  â”‚     # Returns: TypeScriptParser | PythonParser | etc.    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  2. Parse File                                           â”‚   â”‚
â”‚  â”‚     file_content = read_file(file.path)                  â”‚   â”‚
â”‚  â”‚     ast = parser.parse(file_content)                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  3. Extract Code Units                                   â”‚   â”‚
â”‚  â”‚     units = parser.extract_units(ast)                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚     Example Unit (function):                             â”‚   â”‚
â”‚  â”‚     {                                                    â”‚   â”‚
â”‚  â”‚       type: "function",                                  â”‚   â”‚
â”‚  â”‚       name: "authenticateUser",                          â”‚   â”‚
â”‚  â”‚       content: "async function authenticateUser...",     â”‚   â”‚
â”‚  â”‚       docstring: "Authenticates a user...",              â”‚   â”‚
â”‚  â”‚       start_line: 15,                                    â”‚   â”‚
â”‚  â”‚       end_line: 42,                                      â”‚   â”‚
â”‚  â”‚       dependencies: ["validateCredentials", "createToken"]â”‚  â”‚
â”‚  â”‚     }                                                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  4. Create Chunks                                        â”‚   â”‚
â”‚  â”‚     For each unit:                                       â”‚   â”‚
â”‚  â”‚       chunk = Chunk(                                     â”‚   â”‚
â”‚  â”‚         id=generate_id(),                                â”‚   â”‚
â”‚  â”‚         content=unit.content,                            â”‚   â”‚
â”‚  â”‚         file_path=file.path,                             â”‚   â”‚
â”‚  â”‚         chunk_type=unit.type,                            â”‚   â”‚
â”‚  â”‚         symbol_name=unit.name,                           â”‚   â”‚
â”‚  â”‚         line_start=unit.start_line,                      â”‚   â”‚
â”‚  â”‚         line_end=unit.end_line,                          â”‚   â”‚
â”‚  â”‚         language=file.language,                          â”‚   â”‚
â”‚  â”‚         metadata={                                       â”‚   â”‚
â”‚  â”‚           "docstring": unit.docstring,                   â”‚   â”‚
â”‚  â”‚           "dependencies": unit.dependencies              â”‚   â”‚
â”‚  â”‚         }                                                â”‚   â”‚
â”‚  â”‚       )                                                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Progress Event:                                         â”‚   â”‚
â”‚  â”‚    { type: "parse", progress: 0.5, current: file.path } â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  STEP 3: EMBED & STORE                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  For each Chunk:                                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  1. Generate Embedding                                   â”‚   â”‚
â”‚  â”‚     embedding = await OllamaEmbedder.embed(              â”‚   â”‚
â”‚  â”‚       text=chunk.content,                                â”‚   â”‚
â”‚  â”‚       model="mxbai-embed-large"                          â”‚   â”‚
â”‚  â”‚     )                                                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚     HTTP POST http://localhost:11434/api/embeddings      â”‚   â”‚
â”‚  â”‚     Request:                                             â”‚   â”‚
â”‚  â”‚       {                                                  â”‚   â”‚
â”‚  â”‚         "model": "mxbai-embed-large",                    â”‚   â”‚
â”‚  â”‚         "prompt": "async function authenticateUser..."   â”‚   â”‚
â”‚  â”‚       }                                                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚     Response:                                            â”‚   â”‚
â”‚  â”‚       {                                                  â”‚   â”‚
â”‚  â”‚         "embedding": [0.123, -0.456, 0.789, ... ]       â”‚   â”‚
â”‚  â”‚         # 1024 dimensions for mxbai-embed-large          â”‚   â”‚
â”‚  â”‚       }                                                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  2. Store in ChromaDB                                    â”‚   â”‚
â”‚  â”‚     ChromaDBStore.add(                                   â”‚   â”‚
â”‚  â”‚       collection="project_{project_id}",                 â”‚   â”‚
â”‚  â”‚       id=chunk.id,                                       â”‚   â”‚
â”‚  â”‚       embedding=embedding,                               â”‚   â”‚
â”‚  â”‚       document=chunk.content,                            â”‚   â”‚
â”‚  â”‚       metadata={                                         â”‚   â”‚
â”‚  â”‚         "file_path": chunk.file_path,                    â”‚   â”‚
â”‚  â”‚         "chunk_type": chunk.chunk_type,                  â”‚   â”‚
â”‚  â”‚         "symbol_name": chunk.symbol_name,                â”‚   â”‚
â”‚  â”‚         "line_start": chunk.line_start,                  â”‚   â”‚
â”‚  â”‚         "line_end": chunk.line_end,                      â”‚   â”‚
â”‚  â”‚         "language": chunk.language                       â”‚   â”‚
â”‚  â”‚       }                                                  â”‚   â”‚
â”‚  â”‚     )                                                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  3. Track Hash                                           â”‚   â”‚
â”‚  â”‚     file_hash = compute_hash(file.content)               â”‚   â”‚
â”‚  â”‚     HashTracker.save(file.path, file_hash)               â”‚   â”‚
â”‚  â”‚     # Stored in: ~/.localpilot/indexes/{project}/hashes.jsonâ”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Progress Event:                                         â”‚   â”‚
â”‚  â”‚    { type: "embed", progress: 0.85, completed: 200/234 }â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  STEP 4: FINALIZE                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Persist ChromaDB to disk                             â”‚   â”‚
â”‚  â”‚     ~/.localpilot/indexes/{project_id}/chroma.sqlite3    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  2. Save index metadata                                  â”‚   â”‚
â”‚  â”‚     metadata.json:                                       â”‚   â”‚
â”‚  â”‚     {                                                    â”‚   â”‚
â”‚  â”‚       "project_id": "abc123",                            â”‚   â”‚
â”‚  â”‚       "workspace_path": "/path/to/workspace",            â”‚   â”‚
â”‚  â”‚       "indexed_at": "2024-01-15T10:30:00Z",             â”‚   â”‚
â”‚  â”‚       "files_count": 234,                                â”‚   â”‚
â”‚  â”‚       "chunks_count": 1523,                              â”‚   â”‚
â”‚  â”‚       "languages": ["typescript", "python", "dart"]      â”‚   â”‚
â”‚  â”‚     }                                                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  3. Return result to extension                           â”‚   â”‚
â”‚  â”‚     HTTP 200 OK                                          â”‚   â”‚
â”‚  â”‚     {                                                    â”‚   â”‚
â”‚  â”‚       "success": true,                                   â”‚   â”‚
â”‚  â”‚       "files_indexed": 234,                              â”‚   â”‚
â”‚  â”‚       "chunks_created": 1523,                            â”‚   â”‚
â”‚  â”‚       "duration_seconds": 125                            â”‚   â”‚
â”‚  â”‚     }                                                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  4. Trigger summary generation                           â”‚   â”‚
â”‚  â”‚     Extension receives result â†’ calls generateSummary()  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Chat Query Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CHAT QUERY DATA FLOW                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  USER SENDS MESSAGE: "How does authentication work?"            â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ UI: ChatInput component                                  â”‚   â”‚
â”‚  â”‚   â†’ Calls: chatStore.sendMessage(text)                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Extension: ChatService.sendMessage()                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                     â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚            â”‚              â”‚              â”‚                      â”‚
â”‚            â–¼              â–¼              â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Query RAG    â”‚ â”‚ Build Contextâ”‚ â”‚ Stream Chat  â”‚            â”‚
â”‚  â”‚ for Context  â”‚â†’â”‚   Prompt     â”‚â†’â”‚   Response   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                  â”‚
â”‚  DETAILED BREAKDOWN:                                             â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  STEP 1: QUERY RAG                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Extension sends:                                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  HTTP POST /api/query                                    â”‚   â”‚
â”‚  â”‚  {                                                       â”‚   â”‚
â”‚  â”‚    "project_id": "abc123",                               â”‚   â”‚
â”‚  â”‚    "query_text": "How does authentication work?",       â”‚   â”‚
â”‚  â”‚    "top_k": 5                                            â”‚   â”‚
â”‚  â”‚  }                                                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Server (RAGService):                                    â”‚   â”‚
â”‚  â”‚  1. Embed query â†’ [0.234, -0.567, ...]                  â”‚   â”‚
â”‚  â”‚  2. Search ChromaDB for similar chunks                   â”‚   â”‚
â”‚  â”‚  3. Return top 5 most relevant                           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Response:                                               â”‚   â”‚
â”‚  â”‚  {                                                       â”‚   â”‚
â”‚  â”‚    "chunks": [                                           â”‚   â”‚
â”‚  â”‚      {                                                   â”‚   â”‚
â”‚  â”‚        "content": "async function authenticateUser...",  â”‚   â”‚
â”‚  â”‚        "file_path": "src/auth/auth.service.ts",         â”‚   â”‚
â”‚  â”‚        "line_start": 15,                                 â”‚   â”‚
â”‚  â”‚        "line_end": 42,                                   â”‚   â”‚
â”‚  â”‚        "chunk_type": "function",                         â”‚   â”‚
â”‚  â”‚        "symbol_name": "authenticateUser",                â”‚   â”‚
â”‚  â”‚        "similarity_score": 0.87                          â”‚   â”‚
â”‚  â”‚      },                                                  â”‚   â”‚
â”‚  â”‚      { ... 4 more chunks ... }                           â”‚   â”‚
â”‚  â”‚    ]                                                     â”‚   â”‚
â”‚  â”‚  }                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  STEP 2: BUILD CONTEXT PROMPT                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ContextBuilder.buildPrompt(                             â”‚   â”‚
â”‚  â”‚    userMessage: "How does authentication work?",         â”‚   â”‚
â”‚  â”‚    ragChunks: [...],                                     â”‚   â”‚
â”‚  â”‚    history: [previous messages]                          â”‚   â”‚
â”‚  â”‚  )                                                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Assembled Prompt:                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ [SYSTEM PROMPT]                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ You are LocalPilot, an AI assistant for this      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ codebase. Answer questions based on the code      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ context provided.                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ [RAG CONTEXT]                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Relevant code from the project:                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ File: src/auth/auth.service.ts (lines 15-42)      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ```typescript                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ async function authenticateUser(credentials) {     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   // Validates user credentials                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   const user = await validateCredentials(...);     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   if (user) {                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     return createToken(user);                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   }                                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   throw new UnauthorizedError();                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ }                                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ```                                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ File: src/auth/token.ts (lines 8-23)              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ```typescript                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ function createToken(user: User): string {         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   return jwt.sign({ sub: user.id }, SECRET);      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ }                                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ```                                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ... (3 more chunks) ...                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ [CONVERSATION HISTORY]                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ User: What frameworks does this project use?       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Assistant: This project uses React with Redux...   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ [CURRENT QUERY]                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ User: How does authentication work?                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ [INSTRUCTIONS]                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Based on the code context above, explain how       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ authentication works. Reference specific files     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ and functions in your answer.                      â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  STEP 3: STREAM CHAT RESPONSE                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Extension opens WebSocket:                              â”‚   â”‚
â”‚  â”‚  WS ws://localhost:8000/ws/chat                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Extension sends:                                        â”‚   â”‚
â”‚  â”‚  {                                                       â”‚   â”‚
â”‚  â”‚    "type": "chat",                                       â”‚   â”‚
â”‚  â”‚    "project_id": "abc123",                               â”‚   â”‚
â”‚  â”‚    "prompt": "[full prompt from step 2]",               â”‚   â”‚
â”‚  â”‚    "model": "qwen2.5-coder:7b",                         â”‚   â”‚
â”‚  â”‚    "stream": true                                        â”‚   â”‚
â”‚  â”‚  }                                                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Server forwards to Ollama:                              â”‚   â”‚
â”‚  â”‚  HTTP POST http://localhost:11434/api/chat (streaming)   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Server receives tokens from Ollama:                     â”‚   â”‚
â”‚  â”‚  { "message": { "content": "Based" } }                   â”‚   â”‚
â”‚  â”‚  { "message": { "content": " on" } }                     â”‚   â”‚
â”‚  â”‚  { "message": { "content": " the" } }                    â”‚   â”‚
â”‚  â”‚  { "message": { "content": " code" } }                   â”‚   â”‚
â”‚  â”‚  ...                                                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Server forwards to Extension via WebSocket:             â”‚   â”‚
â”‚  â”‚  { "type": "token", "content": "Based" }                 â”‚   â”‚
â”‚  â”‚  { "type": "token", "content": " on" }                   â”‚   â”‚
â”‚  â”‚  { "type": "token", "content": " the" }                  â”‚   â”‚
â”‚  â”‚  { "type": "token", "content": " code" }                 â”‚   â”‚
â”‚  â”‚  ...                                                     â”‚   â”‚
â”‚  â”‚  { "type": "done" }                                      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Extension (MessageHandler):                             â”‚   â”‚
â”‚  â”‚  â€¢ Accumulates tokens                                    â”‚   â”‚
â”‚  â”‚  â€¢ Emits events: 'message:token'                        â”‚   â”‚
â”‚  â”‚  â€¢ UI updates in real-time                               â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Final message displayed to user:                        â”‚   â”‚
â”‚  â”‚  "Based on the code context, authentication works       â”‚   â”‚
â”‚  â”‚   through the `authenticateUser` function in            â”‚   â”‚
â”‚  â”‚   `src/auth/auth.service.ts`. Here's the flow:          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚   1. User credentials are validated...                  â”‚   â”‚
â”‚  â”‚   2. If valid, a JWT token is created...                â”‚   â”‚
â”‚  â”‚   3. The token is returned to the client...             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚   The main files involved are:                          â”‚   â”‚
â”‚  â”‚   â€¢ `auth.service.ts` - Main authentication logic       â”‚   â”‚
â”‚  â”‚   â€¢ `token.ts` - JWT token creation                     â”‚   â”‚
â”‚  â”‚   â€¢ `validators.ts` - Credential validation"            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

## 7. Sequence Diagrams

### 7.1 Plan Generation Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PLAN GENERATION SEQUENCE DIAGRAM                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Actors:                                                         â”‚
â”‚  â€¢ User                                                          â”‚
â”‚  â€¢ WebView (React UI)                                           â”‚
â”‚  â€¢ Extension Host                                                â”‚
â”‚  â€¢ Python Server                                                 â”‚
â”‚  â€¢ Ollama                                                        â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  User        WebView      Extension     Server       Ollama      â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚  Click     â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚ "Transfer  â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚  to Plan"  â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚  postMessageâ”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚ (transfer-  â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚  to-plan)   â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ Get currentâ”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ conversation            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ context    â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ POST       â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ /api/query â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ (get project            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚  structure) â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚ Query      â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚ ChromaDB   â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚â”€â”€â”€â”€â”       â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚    â”‚       â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚â—„â”€â”€â”€â”˜       â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ Chunks[]   â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ Build      â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ planning   â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ prompt     â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â”€â”€â”€â”€â”       â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚    â”‚       â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â—„â”€â”€â”€â”˜       â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ WS /ws/chatâ”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ (stream    â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚  plan)     â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚ POST       â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚ /api/chat  â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚ (stream)   â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚â—„â”€â”€tokenâ”€â”€â”€â”€â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â—„â•â•â•tokenâ•â•â•â”‚            â”‚         â”‚
â”‚   â”‚            â”‚â—„â”€â”€â”€â”€tokenâ”€â”€â”€â”‚            â”‚            â”‚         â”‚
â”‚   â”‚â—„â”€â”€renderâ”€â”€â”€â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚â—„â”€â”€tokenâ”€â”€â”€â”€â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â—„â•â•â•tokenâ•â•â•â”‚            â”‚         â”‚
â”‚   â”‚            â”‚â—„â”€â”€â”€â”€tokenâ”€â”€â”€â”‚            â”‚            â”‚         â”‚
â”‚   â”‚â—„â”€â”€renderâ”€â”€â”€â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚   ... streaming continues ...         â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚â—„â”€â”€â”€doneâ”€â”€â”€â”€â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â—„â•â•â•â•doneâ•â•â•â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ Parse LLM  â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ output to  â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ Plan entityâ”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â”€â”€â”€â”€â”       â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚    â”‚ PlanParser.parse() â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â—„â”€â”€â”€â”˜       â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ Validate   â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚ plan       â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â”€â”€â”€â”€â”       â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚    â”‚       â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚â—„â”€â”€â”€â”˜       â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚ postMessage â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚ (plan-ready,â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚  Plan obj)  â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚ Update      â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚ planStore   â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚â”€â”€â”€â”€â”        â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚    â”‚        â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚â—„â”€â”€â”€â”˜        â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚ Switch to   â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚ Plan tab    â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚â”€â”€â”€â”€â”        â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚    â”‚        â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚â—„â”€â”€â”€â”˜        â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚â—„â”€ Display â”€â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚  Plan UI   â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚            â”‚             â”‚            â”‚            â”‚         â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚         â”‚
â”‚   â”‚                    PLAN READY                      â”‚         â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Plan Generation Prompt Template

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PLANNING PROMPT TEMPLATE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  SYSTEM PROMPT:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ You are LocalPilot in Planning Mode. Your task is to createâ”‚â”‚
â”‚  â”‚ a detailed, actionable implementation plan.                 â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ Based on the conversation and project context, create a     â”‚â”‚
â”‚  â”‚ step-by-step TODO list that can be executed to implement    â”‚â”‚
â”‚  â”‚ the discussed feature.                                      â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ RULES:                                                       â”‚â”‚
â”‚  â”‚ 1. Each task must have a specific file path                 â”‚â”‚
â”‚  â”‚ 2. Tasks should be atomic (one action per task)             â”‚â”‚
â”‚  â”‚ 3. Use existing project patterns and conventions            â”‚â”‚
â”‚  â”‚ 4. Order tasks logically (dependencies first)               â”‚â”‚
â”‚  â”‚ 5. Include testing tasks when appropriate                   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ OUTPUT FORMAT:                                               â”‚â”‚
â”‚  â”‚ Use exactly this markdown structure:                        â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Plan: [Title]                                             â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ### Overview                                                 â”‚â”‚
â”‚  â”‚ [Brief description of what we're building]                  â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ### Implementation Steps                                     â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ - [ ] 1. **[Task Title]**                                   â”‚â”‚
â”‚  â”‚   ğŸ“ `path/to/file.ts`                                      â”‚â”‚
â”‚  â”‚   â”œâ”€ [Detail 1]                                              â”‚â”‚
â”‚  â”‚   â””â”€ [Detail 2]                                              â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ - [ ] 2. **[Task Title]**                                   â”‚â”‚
â”‚  â”‚   ğŸ“ `path/to/another/file.ts`                              â”‚â”‚
â”‚  â”‚   â””â”€ [Detail]                                                â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ### Testing                                                  â”‚â”‚
â”‚  â”‚ - [ ] [How to verify the implementation works]              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  CONTEXT SECTION:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ## Project Context                                          â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ### Project Structure                                        â”‚â”‚
â”‚  â”‚ {Retrieved from RAG - folder structure}                     â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ### Relevant Code                                            â”‚â”‚
â”‚  â”‚ {Retrieved from RAG - similar implementations}              â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ### Conversation Summary                                     â”‚â”‚
â”‚  â”‚ {Summary of chat discussion}                                 â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ User wants to: {extracted goal from conversation}           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 Act Execution Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ACT EXECUTION SEQUENCE DIAGRAM                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Actors:                                                         â”‚
â”‚  â€¢ User                                                          â”‚
â”‚  â€¢ WebView (React UI)                                           â”‚
â”‚  â€¢ Extension Host                                                â”‚
â”‚  â€¢ Python Server                                                 â”‚
â”‚  â€¢ VS Code FileSystem                                           â”‚
â”‚  â€¢ Ollama                                                        â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  User     WebView    Extension   Server    FileSystem  Ollama    â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚ Click   â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚"Approve â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚& Execute"           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ postMessage          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚(execute-plan,        â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ Plan obj)  â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Create TODO.md       â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ (file created)       â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ (execution-started)  â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚(show    â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚progress)â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FOR EACH TASK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ (task-started,       â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚  task[i])  â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚(update  â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚ UI)     â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Query RAG for        â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ similar code         â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚           â”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Chunks[]  â”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ IF MODIFY: Read      â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ existing file        â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚           â”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ fileContent          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Build codeâ”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ generationâ”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ prompt    â”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â”€â”€â”€â”€â”      â”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚    â”‚      â”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â—„â”€â”€â”€â”˜      â”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ WS /ws/chat          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ (generate code)      â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â•â•â•â•â•â•â•â•â•â•â–ºâ”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚ POST      â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚ /api/chat â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â—„â•â•â•â•â•â•â•â•â•â”‚ (code response)     â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Extract  â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ code fromâ”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ response â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â”€â”€â”€â”€â”     â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚    â”‚     â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â—„â”€â”€â”€â”˜     â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ IF MODIFY:           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Generate diff        â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â”€â”€â”€â”€â”     â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚    â”‚ DiffGenerator   â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â—„â”€â”€â”€â”˜     â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ (code-generated,     â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚  code/diff)â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚(show    â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚ preview)â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚ User    â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚ reviews â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚ code    â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IF APPROVED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚ Click   â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚"Apply"  â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ postMessage          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚(apply-task,â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ taskId)    â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Backup   â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ existing â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ file     â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚           â”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Write    â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ new      â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ content  â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ (success)â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Request  â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ re-index â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ file     â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Update   â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ TODO.md  â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ (mark    â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚  done)   â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ (task-completed,     â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚  taskId)   â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚(update  â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚progress)â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IF SKIPPED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚ Click   â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚"Skip"   â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ postMessage          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚(skip-task) â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ Mark taskâ”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚ skipped  â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ (task-skipped)       â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• END FOR EACH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚ (execution-completed,â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚  summary)  â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚(show    â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚complete)â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚         â”‚           â”‚          â”‚           â”‚          â”‚      â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚
â”‚   â”‚                 EXECUTION COMPLETE                     â”‚     â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 Code Generation Prompt Template

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                CODE GENERATION PROMPT TEMPLATE                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  FOR CREATE ACTION:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ You are LocalPilot in Act Mode. Generate code for a new fileâ”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Task                                                      â”‚â”‚
â”‚  â”‚ Create file: `{file_path}`                                   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Description                                               â”‚â”‚
â”‚  â”‚ {task.title}                                                 â”‚â”‚
â”‚  â”‚ {task.description}                                           â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Requirements                                              â”‚â”‚
â”‚  â”‚ {task.details as bullet points}                             â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Project Context                                           â”‚â”‚
â”‚  â”‚ ### Similar Files (for reference)                           â”‚â”‚
â”‚  â”‚ {RAG chunks of similar files}                               â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ### Project Patterns                                         â”‚â”‚
â”‚  â”‚ - Uses {framework} with {conventions}                       â”‚â”‚
â”‚  â”‚ - Follows {naming patterns}                                 â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Output Instructions                                       â”‚â”‚
â”‚  â”‚ 1. Generate ONLY the file content                           â”‚â”‚
â”‚  â”‚ 2. Include necessary imports                                â”‚â”‚
â”‚  â”‚ 3. Add JSDoc/docstring comments                             â”‚â”‚
â”‚  â”‚ 4. Follow project conventions from examples                 â”‚â”‚
â”‚  â”‚ 5. Output code inside ```{language} blocks                  â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ Generate the complete file:                                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  FOR MODIFY ACTION:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ You are LocalPilot in Act Mode. Modify an existing file.    â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Task                                                      â”‚â”‚
â”‚  â”‚ Modify file: `{file_path}`                                   â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Description                                               â”‚â”‚
â”‚  â”‚ {task.title}                                                 â”‚â”‚
â”‚  â”‚ {task.description}                                           â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Current File Content                                      â”‚â”‚
â”‚  â”‚ ```{language}                                                â”‚â”‚
â”‚  â”‚ {existing file content}                                      â”‚â”‚
â”‚  â”‚ ```                                                          â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Required Changes                                          â”‚â”‚
â”‚  â”‚ {task.details as bullet points}                             â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Related Code (from RAG)                                   â”‚â”‚
â”‚  â”‚ {RAG chunks showing patterns}                               â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ ## Output Instructions                                       â”‚â”‚
â”‚  â”‚ 1. Output the COMPLETE modified file                        â”‚â”‚
â”‚  â”‚ 2. Keep existing code that shouldn't change                 â”‚â”‚
â”‚  â”‚ 3. Apply only the requested modifications                   â”‚â”‚
â”‚  â”‚ 4. Maintain existing style and conventions                  â”‚â”‚
â”‚  â”‚ 5. Output inside ```{language} blocks                       â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ Generate the complete modified file:                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.5 Smart Sync Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SMART SYNC SEQUENCE DIAGRAM                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User clicks "Sync Index" after making file changes             â”‚
â”‚                                                                  â”‚
â”‚  User      WebView     Extension    Server      ChromaDB         â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚ Click    â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚ "Sync"   â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚ postMessageâ”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚(sync-index)â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚(sync-started)          â”‚            â”‚             â”‚
â”‚   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚(show     â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚progress) â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚ POST      â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚/api/index/â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚sync       â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ Load storedâ”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ hashes     â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â”€â”€â”€â”€â”       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚    â”‚       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â—„â”€â”€â”€â”˜       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ Scan       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ workspace  â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â”€â”€â”€â”€â”       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚    â”‚       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â—„â”€â”€â”€â”˜       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ Compare    â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ hashes:    â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ changed=[] â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ deleted=[] â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ for file   â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ in scanned:â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚   if hash  â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚   differs: â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚     add to â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚     changedâ”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚(WS: found 5â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚changed,    â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚2 deleted)  â”‚           â”‚            â”‚             â”‚
â”‚   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚(update   â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚ status)  â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â• FOR EACH CHANGED FILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ Delete old â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ embeddings â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ Re-parse   â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ & chunk    â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â”€â”€â”€â”€â”       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚    â”‚       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â—„â”€â”€â”€â”˜       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ Embed new  â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ chunks     â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â”€â”€â”€â–º Ollama â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ Store new  â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ embeddings â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ Update hashâ”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â”€â”€â”€â”€â”       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚    â”‚       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â—„â”€â”€â”€â”˜       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚(WS: progress            â”‚            â”‚             â”‚
â”‚   â”‚          â”‚ 3/5 files) â”‚           â”‚            â”‚             â”‚
â”‚   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â• FOR EACH DELETED FILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ Delete     â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ embeddings â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ Remove fromâ”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚ hash tracker             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â”€â”€â”€â”€â”       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚    â”‚       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚â—„â”€â”€â”€â”˜       â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚ SyncResult            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚ {changed:5,            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚  deleted:2,            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚  duration:12s}         â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚(sync-complete)         â”‚            â”‚             â”‚
â”‚   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚(show     â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚result)   â”‚            â”‚           â”‚            â”‚             â”‚
â”‚   â”‚          â”‚            â”‚           â”‚            â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Interface Definitions

### 8.1 TypeScript Interfaces (Extension)

#### 8.1.1 Core Entities

```typescript
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CORE ENTITY INTERFACES                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/core/entities/project.entity.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Represents an indexed project/workspace
 */
export interface Project {
  /** Unique identifier (hash of workspace path) */
  id: string;
  
  /** Display name (folder name) */
  name: string;
  
  /** Absolute path to workspace */
  workspacePath: string;
  
  /** Index status */
  indexStatus: IndexStatus;
  
  /** When indexing was last completed */
  lastIndexedAt: Date | null;
  
  /** Statistics about indexed content */
  stats: ProjectStats;
  
  /** Languages detected in project */
  languages: string[];
}

export type IndexStatus = 
  | 'not-indexed'
  | 'indexing'
  | 'indexed'
  | 'sync-required'
  | 'error';

export interface ProjectStats {
  filesCount: number;
  chunksCount: number;
  totalLines: number;
  byLanguage: Record<string, number>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/core/entities/message.entity.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Represents a chat message
 */
export interface Message {
  /** Unique message ID */
  id: string;
  
  /** Who sent the message */
  role: 'user' | 'assistant' | 'system';
  
  /** Message content (may include markdown) */
  content: string;
  
  /** When the message was created */
  timestamp: Date;
  
  /** If this message used RAG context */
  ragContext?: RAGContext;
  
  /** Status for assistant messages (streaming) */
  status?: 'streaming' | 'complete' | 'error';
  
  /** Error details if status is 'error' */
  error?: string;
}

export interface RAGContext {
  /** Chunks used to generate response */
  chunks: RetrievedChunk[];
  
  /** Query that was sent to RAG */
  query: string;
}

export interface RetrievedChunk {
  /** Chunk ID in vector store */
  id: string;
  
  /** Code content */
  content: string;
  
  /** File path relative to workspace */
  filePath: string;
  
  /** Starting line number */
  lineStart: number;
  
  /** Ending line number */
  lineEnd: number;
  
  /** Type of code unit */
  chunkType: ChunkType;
  
  /** Symbol name (function/class name) */
  symbolName?: string;
  
  /** Programming language */
  language: string;
  
  /** Similarity score (0-1) */
  score: number;
}

export type ChunkType = 
  | 'function'
  | 'class'
  | 'method'
  | 'interface'
  | 'type'
  | 'variable'
  | 'import'
  | 'module'
  | 'file';  // When entire file is one chunk

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/core/entities/plan.entity.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Represents an implementation plan
 */
export interface Plan {
  /** Unique plan ID */
  id: string;
  
  /** Plan title */
  title: string;
  
  /** Brief description/overview */
  overview: string;
  
  /** List of tasks to execute */
  tasks: Task[];
  
  /** When the plan was created */
  createdAt: Date;
  
  /** When the plan was last modified */
  updatedAt: Date;
  
  /** Current plan status */
  status: PlanStatus;
  
  /** Original conversation that led to this plan */
  sourceConversationId?: string;
}

export type PlanStatus = 
  | 'draft'       // Just generated, not approved
  | 'approved'    // User approved, ready to execute
  | 'executing'   // Currently being executed
  | 'paused'      // Execution paused
  | 'completed'   // All tasks done
  | 'cancelled';  // User cancelled

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/core/entities/task.entity.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Represents a single task in a plan
 */
export interface Task {
  /** Unique task ID */
  id: string;
  
  /** Order in the plan (0-based) */
  orderIndex: number;
  
  /** Short task title */
  title: string;
  
  /** Detailed description */
  description: string;
  
  /** File to create/modify/delete */
  filePath: string;
  
  /** What action to take */
  actionType: TaskActionType;
  
  /** Additional details/requirements */
  details: string[];
  
  /** IDs of tasks this depends on */
  dependencies: string[];
  
  /** Current task status */
  status: TaskStatus;
  
  /** Generated code (after code generation) */
  generatedCode?: string;
  
  /** Diff for modify actions */
  diff?: string;
  
  /** Error message if failed */
  error?: string;
  
  /** Execution timestamps */
  startedAt?: Date;
  completedAt?: Date;
}

export type TaskActionType = 
  | 'create'   // Create new file
  | 'modify'   // Modify existing file
  | 'delete';  // Delete file

export type TaskStatus = 
  | 'pending'     // Not started
  | 'running'     // Currently executing
  | 'awaiting-approval'  // Code generated, waiting for user
  | 'done'        // Successfully completed
  | 'skipped'     // User skipped
  | 'error';      // Failed

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/core/entities/file-change.entity.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Represents a file change to be applied
 */
export interface FileChange {
  /** File path relative to workspace */
  filePath: string;
  
  /** Type of change */
  changeType: 'create' | 'modify' | 'delete';
  
  /** New content (for create/modify) */
  newContent?: string;
  
  /** Original content (for modify, used in diff) */
  originalContent?: string;
  
  /** Unified diff (for modify) */
  diff?: string;
  
  /** Whether backup was created */
  backedUp: boolean;
  
  /** Path to backup file */
  backupPath?: string;
}

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 8.1.2 Core Interfaces (Ports)

```typescript
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CORE INTERFACE DEFINITIONS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/core/interfaces/llm-provider.interface.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Interface for LLM operations
 * 
 * WHY: Abstracts LLM provider (Ollama) so features don't depend
 * on specific implementation. Allows swapping providers.
 */
export interface ILLMProvider {
  /**
   * Check if the LLM provider is available
   */
  isAvailable(): Promise<boolean>;
  
  /**
   * Get list of available models
   */
  listModels(): Promise<ModelInfo[]>;
  
  /**
   * Generate chat completion (non-streaming)
   */
  chat(request: ChatRequest): Promise<ChatResponse>;
  
  /**
   * Generate chat completion with streaming
   */
  chatStream(request: ChatRequest): AsyncGenerator<string, void, unknown>;
  
  /**
   * Generate embeddings for text
   */
  embed(text: string, model?: string): Promise<number[]>;
}

export interface ModelInfo {
  name: string;
  size: number;
  modifiedAt: Date;
  family: string;
  parameterSize: string;
  quantizationLevel: string;
}

export interface ChatRequest {
  model: string;
  messages: Array<{
    role: 'system' | 'user' | 'assistant';
    content: string;
  }>;
  options?: {
    temperature?: number;
    topP?: number;
    maxTokens?: number;
  };
}

export interface ChatResponse {
  content: string;
  model: string;
  totalDuration: number;
  promptEvalCount: number;
  evalCount: number;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/core/interfaces/rag-provider.interface.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Interface for RAG operations
 * 
 * WHY: Abstracts RAG system (Python server + ChromaDB) so
 * features don't depend on specific implementation.
 */
export interface IRAGProvider {
  /**
   * Start indexing a workspace
   */
  startIndexing(
    workspacePath: string,
    projectId: string,
    onProgress: (progress: IndexProgress) => void
  ): Promise<IndexResult>;
  
  /**
   * Sync index (re-index only changed files)
   */
  syncIndex(
    workspacePath: string,
    projectId: string,
    onProgress: (progress: SyncProgress) => void
  ): Promise<SyncResult>;
  
  /**
   * Query for relevant code chunks
   */
  query(
    projectId: string,
    queryText: string,
    topK?: number,
    filters?: QueryFilters
  ): Promise<RetrievedChunk[]>;
  
  /**
   * Get project summary after indexing
   */
  getProjectSummary(projectId: string): Promise<ProjectSummary>;
  
  /**
   * Check if project is indexed
   */
  isIndexed(projectId: string): Promise<boolean>;
  
  /**
   * Clear project index
   */
  clearIndex(projectId: string): Promise<void>;
}

export interface IndexProgress {
  phase: 'scanning' | 'parsing' | 'embedding' | 'storing';
  current: number;
  total: number;
  currentFile?: string;
  message?: string;
}

export interface IndexResult {
  success: boolean;
  filesIndexed: number;
  chunksCreated: number;
  durationSeconds: number;
  languages: string[];
  error?: string;
}

export interface SyncProgress {
  phase: 'scanning' | 'comparing' | 'updating';
  changedFiles: number;
  deletedFiles: number;
  processed: number;
  total: number;
}

export interface SyncResult {
  success: boolean;
  filesUpdated: number;
  filesDeleted: number;
  chunksUpdated: number;
  durationSeconds: number;
}

export interface QueryFilters {
  fileTypes?: string[];
  chunkTypes?: ChunkType[];
  filePaths?: string[];
}

export interface ProjectSummary {
  projectName: string;
  description: string;
  mainLanguages: string[];
  keyFiles: string[];
  architecture: string;
  frameworks: string[];
  stats: ProjectStats;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/core/interfaces/file-system.interface.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Interface for file system operations
 * 
 * WHY: Abstracts VS Code file system API for testability
 * and potential future cross-platform support.
 */
export interface IFileSystem {
  /**
   * Read file content
   */
  readFile(filePath: string): Promise<string>;
  
  /**
   * Write content to file (creates if not exists)
   */
  writeFile(filePath: string, content: string): Promise<void>;
  
  /**
   * Delete a file
   */
  deleteFile(filePath: string): Promise<void>;
  
  /**
   * Check if file exists
   */
  exists(filePath: string): Promise<boolean>;
  
  /**
   * Create directory (recursive)
   */
  createDirectory(dirPath: string): Promise<void>;
  
  /**
   * List files in directory
   */
  listFiles(dirPath: string, recursive?: boolean): Promise<string[]>;
  
  /**
   * Get file stats
   */
  stat(filePath: string): Promise<FileStat>;
  
  /**
   * Create backup of a file
   */
  backup(filePath: string): Promise<string>; // Returns backup path
  
  /**
   * Restore file from backup
   */
  restore(backupPath: string, targetPath: string): Promise<void>;
  
  /**
   * Get workspace root path
   */
  getWorkspaceRoot(): string | undefined;
}

export interface FileStat {
  isFile: boolean;
  isDirectory: boolean;
  size: number;
  modifiedAt: Date;
  createdAt: Date;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/core/interfaces/indexer.interface.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Interface for indexing operations (extension-side)
 * 
 * WHY: Provides high-level indexing control for features.
 */
export interface IIndexer {
  /**
   * Start full indexing of workspace
   */
  startIndexing(): Promise<IndexResult>;
  
  /**
   * Sync index with current workspace state
   */
  syncIndex(): Promise<SyncResult>;
  
  /**
   * Get current indexing status
   */
  getStatus(): IndexStatus;
  
  /**
   * Cancel ongoing indexing
   */
  cancelIndexing(): void;
  
  /**
   * Re-index a single file
   */
  reindexFile(filePath: string): Promise<void>;
  
  /**
   * Subscribe to indexing events
   */
  onProgress(callback: (progress: IndexProgress) => void): Disposable;
  onComplete(callback: (result: IndexResult) => void): Disposable;
  onError(callback: (error: Error) => void): Disposable;
}

export interface Disposable {
  dispose(): void;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/core/interfaces/settings.interface.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Interface for settings management
 */
export interface ISettings {
  /**
   * Get all settings
   */
  getAll(): LocalPilotSettings;
  
  /**
   * Get a specific setting
   */
  get<K extends keyof LocalPilotSettings>(key: K): LocalPilotSettings[K];
  
  /**
   * Update a setting
   */
  set<K extends keyof LocalPilotSettings>(
    key: K, 
    value: LocalPilotSettings[K]
  ): Promise<void>;
  
  /**
   * Reset to defaults
   */
  reset(): Promise<void>;
  
  /**
   * Subscribe to setting changes
   */
  onChange(callback: (settings: LocalPilotSettings) => void): Disposable;
}

export interface LocalPilotSettings {
  // Ollama settings
  ollamaUrl: string;
  chatModel: string;
  embeddingModel: string;
  
  // Indexing settings
  indexingExcludePatterns: string[];
  indexingIncludeExtensions: string[];
  maxFileSizeKb: number;
  
  // Chat settings
  maxContextTokens: number;
  ragTopK: number;
  temperature: number;
  
  // Act mode settings
  autoApproveSimpleTasks: boolean;
  createBackups: boolean;
  
  // UI settings
  theme: 'auto' | 'light' | 'dark';
  showLineNumbers: boolean;
}

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Python Interfaces (Server)

```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PYTHON INTERFACE DEFINITIONS                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# FILE: server/src/core/interfaces/embedder.py
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

from abc import ABC, abstractmethod
from typing import List

class IEmbedder(ABC):
    """
    Interface for embedding generation.
    
    WHY: Abstracts embedding provider (Ollama) so we could
    swap to different embedding models or providers.
    """
    
    @abstractmethod
    async def embed(self, text: str) -> List[float]:
        """
        Generate embedding for a single text.
        
        Args:
            text: Text to embed
            
        Returns:
            List of floats (embedding vector)
        """
        pass
    
    @abstractmethod
    async def embed_batch(self, texts: List[str]) -> List[List[float]]:
        """
        Generate embeddings for multiple texts.
        
        Args:
            texts: List of texts to embed
            
        Returns:
            List of embedding vectors
        """
        pass
    
    @property
    @abstractmethod
    def dimensions(self) -> int:
        """Return the embedding dimensions."""
        pass
    
    @property
    @abstractmethod
    def model_name(self) -> str:
        """Return the model name."""
        pass


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# FILE: server/src/core/interfaces/vector_store.py
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

from abc import ABC, abstractmethod
from typing import List, Dict, Any, Optional
from ..entities.chunk import Chunk

class IVectorStore(ABC):
    """
    Interface for vector storage and retrieval.
    
    WHY: Abstracts vector database (ChromaDB) so we could
    swap to Qdrant or other providers in the future.
    """
    
    @abstractmethod
    async def create_collection(self, name: str) -> None:
        """Create a new collection."""
        pass
    
    @abstractmethod
    async def delete_collection(self, name: str) -> None:
        """Delete a collection and all its data."""
        pass
    
    @abstractmethod
    async def add(
        self,
        collection: str,
        ids: List[str],
        embeddings: List[List[float]],
        documents: List[str],
        metadatas: List[Dict[str, Any]]
    ) -> None:
        """
        Add documents with embeddings to collection.
        
        Args:
            collection: Collection name
            ids: Document IDs
            embeddings: Embedding vectors
            documents: Original text content
            metadatas: Metadata for each document
        """
        pass
    
    @abstractmethod
    async def search(
        self,
        collection: str,
        query_embedding: List[float],
        top_k: int = 5,
        filters: Optional[Dict[str, Any]] = None
    ) -> List[Dict[str, Any]]:
        """
        Search for similar documents.
        
        Args:
            collection: Collection name
            query_embedding: Query vector
            top_k: Number of results
            filters: Metadata filters
            
        Returns:
            List of results with id, document, metadata, score
        """
        pass
    
    @abstractmethod
    async def delete(
        self,
        collection: str,
        ids: Optional[List[str]] = None,
        filters: Optional[Dict[str, Any]] = None
    ) -> None:
        """Delete documents by ID or filter."""
        pass
    
    @abstractmethod
    async def get_collection_stats(self, collection: str) -> Dict[str, Any]:
        """Get statistics about a collection."""
        pass


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# FILE: server/src/core/interfaces/llm.py
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

from abc import ABC, abstractmethod
from typing import List, Dict, Any, AsyncGenerator

class ILLM(ABC):
    """
    Interface for LLM chat operations.
    
    WHY: Abstracts LLM provider for potential multi-provider support.
    """
    
    @abstractmethod
    async def chat(
        self,
        messages: List[Dict[str, str]],
        model: str,
        temperature: float = 0.7,
        max_tokens: Optional[int] = None
    ) -> str:
        """
        Generate chat completion (non-streaming).
        
        Args:
            messages: List of {role, content} messages
            model: Model name
            temperature: Sampling temperature
            max_tokens: Maximum tokens to generate
            
        Returns:
            Generated response text
        """
        pass
    
    @abstractmethod
    async def chat_stream(
        self,
        messages: List[Dict[str, str]],
        model: str,
        temperature: float = 0.7
    ) -> AsyncGenerator[str, None]:
        """
        Generate chat completion with streaming.
        
        Yields:
            Token strings as they're generated
        """
        pass
    
    @abstractmethod
    async def is_available(self) -> bool:
        """Check if LLM is available."""
        pass
    
    @abstractmethod
    async def list_models(self) -> List[Dict[str, Any]]:
        """List available models."""
        pass


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# FILE: server/src/core/interfaces/parser.py
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

from abc import ABC, abstractmethod
from typing import List
from ..entities.chunk import CodeUnit

class IParser(ABC):
    """
    Interface for language-specific code parsing.
    
    WHY: Each language has different syntax. Parser interface
    allows adding new language support easily.
    """
    
    @property
    @abstractmethod
    def language(self) -> str:
        """Return the language this parser handles."""
        pass
    
    @property
    @abstractmethod
    def file_extensions(self) -> List[str]:
        """Return file extensions this parser handles."""
        pass
    
    @abstractmethod
    def parse(self, content: str, file_path: str) -> List[CodeUnit]:
        """
        Parse source code into code units.
        
        Args:
            content: Source code content
            file_path: Path to the file (for context)
            
        Returns:
            List of extracted code units (functions, classes, etc.)
        """
        pass
    
    @abstractmethod
    def can_parse(self, file_path: str) -> bool:
        """Check if this parser can handle the file."""
        pass


# Code unit entity referenced by parser
# FILE: server/src/core/entities/chunk.py

from dataclasses import dataclass
from typing import List, Optional, Dict, Any

@dataclass
class CodeUnit:
    """Represents a parsed code unit (function, class, etc.)"""
    
    unit_type: str  # 'function', 'class', 'method', etc.
    name: str
    content: str
    start_line: int
    end_line: int
    docstring: Optional[str] = None
    dependencies: List[str] = None
    metadata: Dict[str, Any] = None
    
    def __post_init__(self):
        if self.dependencies is None:
            self.dependencies = []
        if self.metadata is None:
            self.metadata = {}


@dataclass 
class Chunk:
    """Represents an indexed chunk with embedding metadata"""
    
    id: str
    content: str
    file_path: str
    chunk_type: str
    symbol_name: Optional[str]
    line_start: int
    line_end: int
    language: str
    embedding: Optional[List[float]] = None
    metadata: Dict[str, Any] = None

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 API Contracts (HTTP/WebSocket)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API CONTRACT DEFINITIONS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

BASE URL: http://localhost:8000/api

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HEALTH & STATUS ENDPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

GET /health
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Response 200:
{
  "status": "healthy",
  "ollama_connected": true,
  "ollama_url": "http://localhost:11434",
  "version": "0.1.0"
}

Response 503:
{
  "status": "unhealthy",
  "ollama_connected": false,
  "error": "Cannot connect to Ollama"
}


GET /models
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Response 200:
{
  "models": [
    {
      "name": "qwen2.5-coder:7b-instruct-q4_K_M",
      "size": 4500000000,
      "family": "qwen2",
      "parameter_size": "7B",
      "quantization": "Q4_K_M"
    },
    {
      "name": "mxbai-embed-large:latest",
      "size": 670000000,
      "family": "mxbai",
      "parameter_size": "335M",
      "quantization": "F16"
    }
  ]
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
INDEXING ENDPOINTS  
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /index/start
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Request:
{
  "workspace_path": "/path/to/workspace",
  "project_id": "abc123"
}

Response 202 (Accepted):
{
  "status": "started",
  "project_id": "abc123",
  "message": "Indexing started. Connect to WebSocket for progress."
}

Response 400:
{
  "error": "workspace_path is required"
}

Response 409:
{
  "error": "Indexing already in progress for this project"
}


POST /index/sync
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Request:
{
  "workspace_path": "/path/to/workspace",
  "project_id": "abc123"
}

Response 202:
{
  "status": "started",
  "project_id": "abc123"
}


GET /index/status/{project_id}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Response 200 (indexed):
{
  "project_id": "abc123",
  "status": "indexed",
  "last_indexed_at": "2024-01-15T10:30:00Z",
  "stats": {
    "files_count": 234,
    "chunks_count": 1523,
    "languages": ["typescript", "python"]
  }
}

Response 200 (not indexed):
{
  "project_id": "abc123",
  "status": "not-indexed"
}


DELETE /index/{project_id}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Response 200:
{
  "status": "deleted",
  "project_id": "abc123"
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RAG QUERY ENDPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /query
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Request:
{
  "project_id": "abc123",
  "query_text": "How does authentication work?",
  "top_k": 5,
  "filters": {
    "file_types": ["typescript"],
    "chunk_types": ["function", "class"]
  }
}

Response 200:
{
  "chunks": [
    {
      "id": "chunk_001",
      "content": "async function authenticateUser(credentials)...",
      "file_path": "src/auth/auth.service.ts",
      "line_start": 15,
      "line_end": 42,
      "chunk_type": "function",
      "symbol_name": "authenticateUser",
      "language": "typescript",
      "score": 0.87
    },
    // ... more chunks
  ],
  "query_time_ms": 45
}


GET /summary/{project_id}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Response 200:
{
  "project_name": "my-app",
  "description": "A React application with Express backend...",
  "main_languages": ["typescript", "javascript"],
  "key_files": [
    "src/App.tsx",
    "src/server/index.ts",
    "src/api/routes.ts"
  ],
  "architecture": "React frontend with Express API backend",
  "frameworks": ["React", "Express", "Redux"],
  "stats": {
    "files_count": 234,
    "chunks_count": 1523,
    "total_lines": 45000
  }
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CHAT ENDPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /chat (non-streaming)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Request:
{
  "project_id": "abc123",
  "messages": [
    {"role": "system", "content": "You are LocalPilot..."},
    {"role": "user", "content": "How does auth work?"}
  ],
  "model": "qwen2.5-coder:7b-instruct-q4_K_M",
  "include_rag": true,
  "rag_top_k": 5
}

Response 200:
{
  "response": "Based on the code, authentication works by...",
  "model": "qwen2.5-coder:7b-instruct-q4_K_M",
  "rag_chunks_used": 5,
  "total_tokens": 1250,
  "duration_ms": 3400
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
WEBSOCKET ENDPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

WS /ws/chat
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Connect: ws://localhost:8000/ws/chat

Client sends:
{
  "type": "chat",
  "project_id": "abc123",
  "messages": [...],
  "model": "qwen2.5-coder:7b-instruct-q4_K_M",
  "include_rag": true
}

Server sends (streaming):
{"type": "rag_start"}
{"type": "rag_chunk", "chunk": {...}}
{"type": "rag_chunk", "chunk": {...}}
{"type": "rag_complete", "count": 5}
{"type": "token", "content": "Based"}
{"type": "token", "content": " on"}
{"type": "token", "content": " the"}
// ... more tokens
{"type": "done", "total_tokens": 450}

Error:
{"type": "error", "message": "Model not found"}


WS /ws/progress
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Connect: ws://localhost:8000/ws/progress?project_id=abc123

Server sends (during indexing):
{"type": "started", "project_id": "abc123"}
{"type": "progress", "phase": "scanning", "current": 50, "total": 234}
{"type": "progress", "phase": "parsing", "current": 100, "total": 234, "file": "src/auth.ts"}
{"type": "progress", "phase": "embedding", "current": 150, "total": 234}
{"type": "progress", "phase": "storing", "current": 200, "total": 234}
{"type": "completed", "result": {"files_indexed": 234, "chunks_created": 1523}}

Or:
{"type": "error", "message": "Failed to parse file: src/bad.ts"}

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 9. State Management

### 9.1 Zustand Store Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATE MANAGEMENT OVERVIEW                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  WHY ZUSTAND?                                                    â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  â€¢ Lightweight (~1KB)                                            â”‚
â”‚  â€¢ Simple API, minimal boilerplate                              â”‚
â”‚  â€¢ No providers needed                                           â”‚
â”‚  â€¢ Built-in TypeScript support                                  â”‚
â”‚  â€¢ Works great with React                                        â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  STORE STRUCTURE:                                                â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      ROOT STATE                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  appStore   â”‚  â”‚  chatStore  â”‚  â”‚  planStore  â”‚      â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚      â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ mode      â”‚  â”‚ â€¢ messages  â”‚  â”‚ â€¢ plan      â”‚      â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ project   â”‚  â”‚ â€¢ isLoading â”‚  â”‚ â€¢ isLoading â”‚      â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ ollama    â”‚  â”‚ â€¢ error     â”‚  â”‚ â€¢ error     â”‚      â”‚   â”‚
â”‚  â”‚  â”‚   Status    â”‚  â”‚             â”‚  â”‚             â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  actStore   â”‚  â”‚         settingsStore           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ plan      â”‚  â”‚ â€¢ ollamaUrl    â€¢ chatModel      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ current   â”‚  â”‚ â€¢ embedModel   â€¢ temperature    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   Task      â”‚  â”‚ â€¢ ragTopK      â€¢ autoApprove    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ status    â”‚  â”‚                                  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 Store Implementations

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/ui/webview/store/app.store.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import { create } from 'zustand';

type AppMode = 'onboarding' | 'chat' | 'plan' | 'act';
type OllamaStatus = 'checking' | 'connected' | 'disconnected' | 'error';
type IndexStatus = 'not-indexed' | 'indexing' | 'indexed' | 'sync-required';

interface AppState {
  // Current mode
  mode: AppMode;
  
  // Project info
  projectId: string | null;
  projectName: string | null;
  workspacePath: string | null;
  
  // Ollama connection
  ollamaStatus: OllamaStatus;
  ollamaError: string | null;
  availableModels: string[];
  
  // Indexing
  indexStatus: IndexStatus;
  indexProgress: number;
  indexMessage: string | null;
  
  // Actions
  setMode: (mode: AppMode) => void;
  setProject: (id: string, name: string, path: string) => void;
  setOllamaStatus: (status: OllamaStatus, error?: string) => void;
  setModels: (models: string[]) => void;
  setIndexStatus: (status: IndexStatus) => void;
  setIndexProgress: (progress: number, message?: string) => void;
  reset: () => void;
}

export const useAppStore = create<AppState>((set) => ({
  // Initial state
  mode: 'onboarding',
  projectId: null,
  projectName: null,
  workspacePath: null,
  ollamaStatus: 'checking',
  ollamaError: null,
  availableModels: [],
  indexStatus: 'not-indexed',
  indexProgress: 0,
  indexMessage: null,
  
  // Actions
  setMode: (mode) => set({ mode }),
  
  setProject: (id, name, path) => set({
    projectId: id,
    projectName: name,
    workspacePath: path
  }),
  
  setOllamaStatus: (status, error) => set({
    ollamaStatus: status,
    ollamaError: error || null
  }),
  
  setModels: (models) => set({ availableModels: models }),
  
  setIndexStatus: (status) => set({ indexStatus: status }),
  
  setIndexProgress: (progress, message) => set({
    indexProgress: progress,
    indexMessage: message || null
  }),
  
  reset: () => set({
    mode: 'onboarding',
    indexStatus: 'not-indexed',
    indexProgress: 0
  })
}));


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/ui/webview/store/chat.store.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface ChatState {
  messages: Message[];
  isLoading: boolean;
  isStreaming: boolean;
  error: string | null;
  ragChunks: RetrievedChunk[];
  
  // Actions
  addMessage: (message: Message) => void;
  updateLastMessage: (content: string) => void;
  appendToLastMessage: (token: string) => void;
  setLoading: (loading: boolean) => void;
  setStreaming: (streaming: boolean) => void;
  setError: (error: string | null) => void;
  setRagChunks: (chunks: RetrievedChunk[]) => void;
  clearMessages: () => void;
}

export const useChatStore = create<ChatState>((set, get) => ({
  messages: [],
  isLoading: false,
  isStreaming: false,
  error: null,
  ragChunks: [],
  
  addMessage: (message) => set((state) => ({
    messages: [...state.messages, message]
  })),
  
  updateLastMessage: (content) => set((state) => {
    const messages = [...state.messages];
    if (messages.length > 0) {
      messages[messages.length - 1].content = content;
    }
    return { messages };
  }),
  
  appendToLastMessage: (token) => set((state) => {
    const messages = [...state.messages];
    if (messages.length > 0) {
      messages[messages.length - 1].content += token;
    }
    return { messages };
  }),
  
  setLoading: (loading) => set({ isLoading: loading }),
  setStreaming: (streaming) => set({ isStreaming: streaming }),
  setError: (error) => set({ error }),
  setRagChunks: (chunks) => set({ ragChunks: chunks }),
  clearMessages: () => set({ messages: [], ragChunks: [] })
}));


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/ui/webview/store/plan.store.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface PlanState {
  plan: Plan | null;
  isGenerating: boolean;
  error: string | null;
  
  // Actions
  setPlan: (plan: Plan) => void;
  updateTask: (taskId: string, updates: Partial<Task>) => void;
  setGenerating: (generating: boolean) => void;
  setError: (error: string | null) => void;
  clearPlan: () => void;
}

export const usePlanStore = create<PlanState>((set) => ({
  plan: null,
  isGenerating: false,
  error: null,
  
  setPlan: (plan) => set({ plan, error: null }),
  
  updateTask: (taskId, updates) => set((state) => {
    if (!state.plan) return state;
    
    const tasks = state.plan.tasks.map((task) =>
      task.id === taskId ? { ...task, ...updates } : task
    );
    
    return { plan: { ...state.plan, tasks } };
  }),
  
  setGenerating: (generating) => set({ isGenerating: generating }),
  setError: (error) => set({ error }),
  clearPlan: () => set({ plan: null, error: null })
}));


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE: extension/src/ui/webview/store/act.store.ts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type ExecutionStatus = 'idle' | 'running' | 'paused' | 'completed' | 'error';

interface ActState {
  plan: Plan | null;
  status: ExecutionStatus;
  currentTaskIndex: number;
  currentTaskCode: string | null;
  currentTaskDiff: string | null;
  error: string | null;
  
  // Actions
  startExecution: (plan: Plan) => void;
  setCurrentTask: (index: number) => void;
  setTaskCode: (code: string, diff?: string) => void;
  updateTaskStatus: (taskId: string, status: TaskStatus) => void;
  setStatus: (status: ExecutionStatus) => void;
  setError: (error: string | null) => void;
  reset: () => void;
}

export const useActStore = create<ActState>((set) => ({
  plan: null,
  status: 'idle',
  currentTaskIndex: -1,
  currentTaskCode: null,
  currentTaskDiff: null,
  error: null,
  
  startExecution: (plan) => set({
    plan,
    status: 'running',
    currentTaskIndex: 0,
    error: null
  }),
  
  setCurrentTask: (index) => set({
    currentTaskIndex: index,
    currentTaskCode: null,
    currentTaskDiff: null
  }),
  
  setTaskCode: (code, diff) => set({
    currentTaskCode: code,
    currentTaskDiff: diff || null
  }),
  
  updateTaskStatus: (taskId, status) => set((state) => {
    if (!state.plan) return state;
    
    const tasks = state.plan.tasks.map((task) =>
      task.id === taskId ? { ...task, status } : task
    );
    
    return { plan: { ...state.plan, tasks } };
  }),
  
  setStatus: (status) => set({ status }),
  setError: (error) => set({ error, status: 'error' }),
  reset: () => set({
    plan: null,
    status: 'idle',
    currentTaskIndex: -1,
    currentTaskCode: null,
    currentTaskDiff: null,
    error: null
  })
}));
```

### 9.3 State Flow Between Modes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  STATE FLOW BETWEEN MODES                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ONBOARDING â†’ CHAT                                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Trigger: Indexing completes successfully                       â”‚
â”‚                                                                  â”‚
â”‚  State Changes:                                                  â”‚
â”‚  â€¢ appStore.mode = 'chat'                                       â”‚
â”‚  â€¢ appStore.indexStatus = 'indexed'                             â”‚
â”‚  â€¢ chatStore.addMessage(projectSummary)                         â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  CHAT â†’ PLAN                                                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Trigger: User clicks "Transfer to Plan"                        â”‚
â”‚                                                                  â”‚
â”‚  State Changes:                                                  â”‚
â”‚  â€¢ planStore.setGenerating(true)                                â”‚
â”‚  â€¢ [Generate plan from conversation]                            â”‚
â”‚  â€¢ planStore.setPlan(generatedPlan)                             â”‚
â”‚  â€¢ planStore.setGenerating(false)                               â”‚
â”‚  â€¢ appStore.mode = 'plan'                                       â”‚
â”‚                                                                  â”‚
â”‚  Data Transferred:                                               â”‚
â”‚  â€¢ chatStore.messages â†’ Used for context                        â”‚
â”‚  â€¢ chatStore.ragChunks â†’ Used for project understanding         â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PLAN â†’ ACT                                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Trigger: User clicks "Approve & Execute"                       â”‚
â”‚                                                                  â”‚
â”‚  State Changes:                                                  â”‚
â”‚  â€¢ planStore.plan.status = 'approved'                           â”‚
â”‚  â€¢ actStore.startExecution(planStore.plan)                      â”‚
â”‚  â€¢ appStore.mode = 'act'                                        â”‚
â”‚                                                                  â”‚
â”‚  Data Transferred:                                               â”‚
â”‚  â€¢ planStore.plan â†’ actStore.plan (deep copy)                   â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  ACT â†’ CHAT (after completion)                                   â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Trigger: Execution completes or user returns                   â”‚
â”‚                                                                  â”‚
â”‚  State Changes:                                                  â”‚
â”‚  â€¢ chatStore.addMessage(executionSummary)                       â”‚
â”‚  â€¢ actStore.reset()                                              â”‚
â”‚  â€¢ planStore.clearPlan()                                        â”‚
â”‚  â€¢ appStore.mode = 'chat'                                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. Error Handling Strategy

### 10.1 Error Categories

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ERROR CATEGORIES                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  CATEGORY 1: CONNECTION ERRORS                                   â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Source: Ollama or Python server unreachable                    â”‚
â”‚  Severity: Critical                                              â”‚
â”‚  Recovery: Retry with backoff, show reconnect option            â”‚
â”‚                                                                  â”‚
â”‚  Examples:                                                       â”‚
â”‚  â€¢ OllamaConnectionError - Ollama not running                   â”‚
â”‚  â€¢ ServerConnectionError - Python server not running            â”‚
â”‚  â€¢ TimeoutError - Request timed out                             â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  CATEGORY 2: INDEXING ERRORS                                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Source: File parsing, embedding, or storage failures           â”‚
â”‚  Severity: Medium (can skip problematic files)                  â”‚
â”‚  Recovery: Skip file, continue indexing, report at end          â”‚
â”‚                                                                  â”‚
â”‚  Examples:                                                       â”‚
â”‚  â€¢ ParseError - Tree-sitter failed to parse file               â”‚
â”‚  â€¢ EmbeddingError - Ollama failed to embed text                â”‚
â”‚  â€¢ StorageError - ChromaDB write failed                        â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  CATEGORY 3: LLM ERRORS                                          â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Source: Model not found, context overflow, generation fail     â”‚
â”‚  Severity: Medium                                                â”‚
â”‚  Recovery: Retry, suggest different model, truncate context     â”‚
â”‚                                                                  â”‚
â”‚  Examples:                                                       â”‚
â”‚  â€¢ ModelNotFoundError - Requested model not in Ollama          â”‚
â”‚  â€¢ ContextOverflowError - Input too long for model             â”‚
â”‚  â€¢ GenerationError - Model failed to generate response         â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  CATEGORY 4: FILE OPERATION ERRORS                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Source: File read/write failures                               â”‚
â”‚  Severity: High (can corrupt user files)                        â”‚
â”‚  Recovery: Restore from backup, abort task                      â”‚
â”‚                                                                  â”‚
â”‚  Examples:                                                       â”‚
â”‚  â€¢ FileNotFoundError - File doesn't exist                       â”‚
â”‚  â€¢ PermissionError - No write access                            â”‚
â”‚  â€¢ DirectoryNotEmptyError - Cannot delete                       â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  CATEGORY 5: VALIDATION ERRORS                                   â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Source: Invalid input, malformed data                          â”‚
â”‚  Severity: Low                                                   â”‚
â”‚  Recovery: Show validation message, request correction          â”‚
â”‚                                                                  â”‚
â”‚  Examples:                                                       â”‚
â”‚  â€¢ InvalidPathError - Path outside workspace                    â”‚
â”‚  â€¢ PlanParseError - Cannot parse LLM output to plan            â”‚
â”‚  â€¢ InvalidSettingError - Setting value out of range            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 Error Class Hierarchy

```typescript
// FILE: extension/src/core/errors/base.error.ts

export abstract class LocalPilotError extends Error {
  abstract readonly code: string;
  abstract readonly category: ErrorCategory;
  abstract readonly recoverable: boolean;
  
  constructor(
    message: string,
    public readonly details?: Record<string, unknown>
  ) {
    super(message);
    this.name = this.constructor.name;
  }
  
  toJSON() {
    return {
      name: this.name,
      code: this.code,
      message: this.message,
      category: this.category,
      recoverable: this.recoverable,
      details: this.details
    };
  }
}

export type ErrorCategory = 
  | 'connection'
  | 'indexing'
  | 'llm'
  | 'file'
  | 'validation';


// FILE: extension/src/core/errors/ollama.error.ts

export class OllamaConnectionError extends LocalPilotError {
  readonly code = 'OLLAMA_CONNECTION_FAILED';
  readonly category = 'connection' as const;
  readonly recoverable = true;
  
  constructor(url: string, cause?: Error) {
    super(`Cannot connect to Ollama at ${url}`, { url, cause: cause?.message });
  }
}

export class OllamaModelNotFoundError extends LocalPilotError {
  readonly code = 'OLLAMA_MODEL_NOT_FOUND';
  readonly category = 'llm' as const;
  readonly recoverable = true;
  
  constructor(model: string) {
    super(`Model "${model}" not found in Ollama`, { model });
  }
}


// FILE: extension/src/core/errors/indexing.error.ts

export class IndexingError extends LocalPilotError {
  readonly code = 'INDEXING_FAILED';
  readonly category = 'indexing' as const;
  readonly recoverable = true;
  
  constructor(message: string, public readonly failedFiles: string[]) {
    super(message, { failedFiles });
  }
}

export class ParseError extends LocalPilotError {
  readonly code = 'PARSE_FAILED';
  readonly category = 'indexing' as const;
  readonly recoverable = true;
  
  constructor(filePath: string, reason: string) {
    super(`Failed to parse ${filePath}: ${reason}`, { filePath, reason });
  }
}


// FILE: extension/src/core/errors/file-operation.error.ts

export class FileOperationError extends LocalPilotError {
  readonly code = 'FILE_OPERATION_FAILED';
  readonly category = 'file' as const;
  readonly recoverable = false;
  
  constructor(
    operation: 'read' | 'write' | 'delete',
    filePath: string,
    reason: string
  ) {
    super(`Failed to ${operation} file ${filePath}: ${reason}`, {
      operation,
      filePath,
      reason
    });
  }
}
```

### 10.3 Error Handling Patterns

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ERROR HANDLING PATTERNS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  PATTERN 1: Retry with Exponential Backoff                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Used for: Connection errors, transient failures               â”‚
â”‚                                                                  â”‚
â”‚  async function withRetry<T>(                                    â”‚
â”‚    fn: () => Promise<T>,                                         â”‚
â”‚    maxAttempts = 3,                                              â”‚
â”‚    baseDelay = 1000                                              â”‚
â”‚  ): Promise<T> {                                                 â”‚
â”‚    for (let attempt = 1; attempt <= maxAttempts; attempt++) {   â”‚
â”‚      try {                                                       â”‚
â”‚        return await fn();                                        â”‚
â”‚      } catch (error) {                                           â”‚
â”‚        if (attempt === maxAttempts) throw error;                â”‚
â”‚        const delay = baseDelay * Math.pow(2, attempt - 1);      â”‚
â”‚        await sleep(delay);                                       â”‚
â”‚      }                                                           â”‚
â”‚    }                                                             â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PATTERN 2: Graceful Degradation                                â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Used for: Indexing (skip bad files, continue)                  â”‚
â”‚                                                                  â”‚
â”‚  async function indexWithGracefulDegradation(files: string[]) { â”‚
â”‚    const results = { success: [], failed: [] };                 â”‚
â”‚                                                                  â”‚
â”‚    for (const file of files) {                                   â”‚
â”‚      try {                                                       â”‚
â”‚        await indexFile(file);                                    â”‚
â”‚        results.success.push(file);                               â”‚
â”‚      } catch (error) {                                           â”‚
â”‚        logger.warn(`Skipping ${file}: ${error.message}`);       â”‚
â”‚        results.failed.push({ file, error: error.message });     â”‚
â”‚      }                                                           â”‚
â”‚    }                                                             â”‚
â”‚                                                                  â”‚
â”‚    if (results.failed.length > 0) {                             â”‚
â”‚      showWarning(`${results.failed.length} files skipped`);     â”‚
â”‚    }                                                             â”‚
â”‚                                                                  â”‚
â”‚    return results;                                               â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PATTERN 3: User-Facing Error Messages                          â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Used for: All errors shown to user                             â”‚
â”‚                                                                  â”‚
â”‚  function getUserMessage(error: LocalPilotError): string {      â”‚
â”‚    const messages: Record<string, string> = {                   â”‚
â”‚      OLLAMA_CONNECTION_FAILED:                                   â”‚
â”‚        'Cannot connect to Ollama. Make sure Ollama is running.',â”‚
â”‚      OLLAMA_MODEL_NOT_FOUND:                                     â”‚
â”‚        'Model not found. Run "ollama pull <model>" to install.',â”‚
â”‚      FILE_OPERATION_FAILED:                                      â”‚
â”‚        'File operation failed. Check file permissions.',        â”‚
â”‚    };                                                            â”‚
â”‚                                                                  â”‚
â”‚    return messages[error.code] || error.message;                â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PATTERN 4: Backup Before Modify                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  Used for: Act mode file modifications                          â”‚
â”‚                                                                  â”‚
â”‚  async function safeModifyFile(                                  â”‚
â”‚    filePath: string,                                             â”‚
â”‚    newContent: string                                            â”‚
â”‚  ): Promise<void> {                                              â”‚
â”‚    // 1. Create backup                                           â”‚
â”‚    const backupPath = await fileSystem.backup(filePath);        â”‚
â”‚                                                                  â”‚
â”‚    try {                                                         â”‚
â”‚      // 2. Write new content                                     â”‚
â”‚      await fileSystem.writeFile(filePath, newContent);          â”‚
â”‚    } catch (error) {                                             â”‚
â”‚      // 3. Restore from backup on failure                       â”‚
â”‚      await fileSystem.restore(backupPath, filePath);            â”‚
â”‚      throw new FileOperationError('write', filePath, error.msg);â”‚
â”‚    }                                                             â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. Security Considerations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SECURITY CONSIDERATIONS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  PRINCIPLE 1: LOCALHOST ONLY                                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  All network communication stays on localhost:                  â”‚
â”‚  â€¢ Python server: 127.0.0.1:8000                               â”‚
â”‚  â€¢ Ollama: 127.0.0.1:11434                                      â”‚
â”‚  â€¢ No external network calls                                     â”‚
â”‚  â€¢ No telemetry or analytics                                     â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PRINCIPLE 2: WORKSPACE SANDBOXING                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  File operations are restricted to workspace:                   â”‚
â”‚                                                                  â”‚
â”‚  function validatePath(filePath: string): boolean {             â”‚
â”‚    const workspaceRoot = getWorkspaceRoot();                    â”‚
â”‚    const absolutePath = path.resolve(workspaceRoot, filePath);  â”‚
â”‚                                                                  â”‚
â”‚    // Ensure path is within workspace                           â”‚
â”‚    if (!absolutePath.startsWith(workspaceRoot)) {               â”‚
â”‚      throw new SecurityError('Path outside workspace');          â”‚
â”‚    }                                                             â”‚
â”‚                                                                  â”‚
â”‚    // Block sensitive files                                      â”‚
â”‚    const blocked = ['.env', '.git/config', 'secrets'];          â”‚
â”‚    for (const pattern of blocked) {                             â”‚
â”‚      if (absolutePath.includes(pattern)) {                      â”‚
â”‚        throw new SecurityError('Access to sensitive file');      â”‚
â”‚      }                                                           â”‚
â”‚    }                                                             â”‚
â”‚                                                                  â”‚
â”‚    return true;                                                  â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PRINCIPLE 3: USER APPROVAL FOR ACTIONS                          â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Act mode requires explicit approval:                           â”‚
â”‚  â€¢ Every file change shown before applying                      â”‚
â”‚  â€¢ User must click "Apply" for each task                        â”‚
â”‚  â€¢ "Skip" option always available                                â”‚
â”‚  â€¢ No silent file modifications                                  â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PRINCIPLE 4: BACKUP BEFORE MODIFY                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  All file modifications are reversible:                         â”‚
â”‚  â€¢ Backup created in .localpilot/backups/                       â”‚
â”‚  â€¢ Timestamped backup folders                                    â”‚
â”‚  â€¢ Backup includes original content                              â”‚
â”‚  â€¢ Restore mechanism available                                   â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PRINCIPLE 5: NO CODE EXECUTION (MVP)                            â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  MVP does not execute arbitrary code:                           â”‚
â”‚  â€¢ No terminal command execution                                 â”‚
â”‚  â€¢ No script running                                             â”‚
â”‚  â€¢ Only file create/modify/delete operations                    â”‚
â”‚  â€¢ Terminal support added in v1.1 with additional safeguards    â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PRINCIPLE 6: DATA STAYS LOCAL                                   â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  User data never leaves the machine:                            â”‚
â”‚  â€¢ Index stored in ~/.localpilot/                               â”‚
â”‚  â€¢ No cloud sync                                                 â”‚
â”‚  â€¢ No external API calls                                         â”‚
â”‚  â€¢ All processing via local Ollama                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DEPLOYMENT ARCHITECTURE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  COMPONENT LIFECYCLE:                                            â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  1. USER STARTS VS CODE                                          â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  2. EXTENSION ACTIVATES                                          â”‚
â”‚     â€¢ Checks for Python server                                   â”‚
â”‚     â€¢ Starts Python server if not running                       â”‚
â”‚     â€¢ Checks Ollama connection                                   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  3. PYTHON SERVER STARTS                                         â”‚
â”‚     â€¢ Binds to localhost:8000                                   â”‚
â”‚     â€¢ Initializes ChromaDB                                       â”‚
â”‚     â€¢ Connects to Ollama                                         â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  4. READY FOR USE                                                â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  PYTHON SERVER MANAGEMENT:                                       â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Option A: Bundled Python (Recommended for MVP)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  extension/                                              â”‚   â”‚
â”‚  â”‚  â””â”€â”€ bundled/                                            â”‚   â”‚
â”‚  â”‚      â””â”€â”€ server/           â† Python server included      â”‚   â”‚
â”‚  â”‚          â”œâ”€â”€ src/                                        â”‚   â”‚
â”‚  â”‚          â”œâ”€â”€ requirements.txt                            â”‚   â”‚
â”‚  â”‚          â””â”€â”€ run.py                                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Extension starts server:                                â”‚   â”‚
â”‚  â”‚  spawn('python', ['run.py'], { cwd: bundledPath })       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  Option B: System Python (Alternative)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ User installs server separately via pip              â”‚   â”‚
â”‚  â”‚  â€¢ pip install localpilot-server                         â”‚   â”‚
â”‚  â”‚  â€¢ Extension connects to running server                  â”‚   â”‚
â”‚  â”‚  â€¢ More flexible but more setup                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  FILE LOCATIONS:                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  Windows:                                                        â”‚
â”‚  â€¢ Extension: %USERPROFILE%\.vscode\extensions\localpilot\      â”‚
â”‚  â€¢ User data: %USERPROFILE%\.localpilot\                        â”‚
â”‚  â€¢ Indexes: %USERPROFILE%\.localpilot\indexes\                  â”‚
â”‚  â€¢ Logs: %USERPROFILE%\.localpilot\logs\                        â”‚
â”‚                                                                  â”‚
â”‚  macOS/Linux (Future):                                           â”‚
â”‚  â€¢ Extension: ~/.vscode/extensions/localpilot/                  â”‚
â”‚  â€¢ User data: ~/.localpilot/                                     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 13. WebView Communication Protocol

```md
Reference WEBVIEW_PROTOCOL.md
```

---

## 14. Architecture Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ARCHITECTURE SUMMARY                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  KEY DECISIONS:                                                  â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                  â”‚
â”‚  âœ“ Practical Clean Architecture                                 â”‚
â”‚    â””â”€â”€ Testable, maintainable, junior-friendly                  â”‚
â”‚                                                                  â”‚
â”‚  âœ“ Hybrid TypeScript + Python                                   â”‚
â”‚    â””â”€â”€ Best tools for each job                                  â”‚
â”‚                                                                  â”‚
â”‚  âœ“ HTTP + WebSocket communication                               â”‚
â”‚    â””â”€â”€ REST for operations, WS for streaming                    â”‚
â”‚                                                                  â”‚
â”‚  âœ“ Zustand for state management                                 â”‚
â”‚    â””â”€â”€ Simple, lightweight, React-friendly                      â”‚
â”‚                                                                  â”‚
â”‚  âœ“ LlamaIndex for RAG                                           â”‚
â”‚    â””â”€â”€ Built for code indexing, simpler than LangChain          â”‚
â”‚                                                                  â”‚
â”‚  âœ“ ChromaDB for vectors                                         â”‚
â”‚    â””â”€â”€ Easy setup, Python native, good for MVP                  â”‚
â”‚                                                                  â”‚
â”‚  âœ“ AST-aware indexing with Tree-sitter                          â”‚
â”‚    â””â”€â”€ Quality over simplicity (your requirement)               â”‚
â”‚                                                                  â”‚
â”‚  âœ“ Privacy-first with localhost-only communication              â”‚
â”‚    â””â”€â”€ Core value proposition                                    â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Document Approval

| Role | Name | Date | Signature |
|------|------|------|-----------|
| Project Owner | TarekRefaei | | |

---

*Document Version: 1.0.0*
*Created: Planning Phase*
*Last Updated: [Current Date]*